var standby_status=-1,timerFormInitiated=-1;function initJsTranslationAddon(e){tstr_timer=e.timer,tstr_loading=e.loading,tstr_add_timer=e.add_timer,tstr_cancel=e.cancel,tstr_close=e.close,tstr_rename=e.rename,tstr_prompt_save_changes=e.prompt_save_changes,tstr_oops=e.oops,tstr_weekday=e.at_filter_weekday,tstr_weekend=e.at_filter_weekend,tstr_at_del=e.at_del,tstr_at_filter_title=e.at_filter_title,tstr_at_filter_short_desc=e.at_filter_short_desc,tstr_at_filter_desc=e.at_filter_desc,tstr_at_filter_day=e.at_filter_day,tstr_at_filter_include=e.at_filter_include,tstr_at_filter_exclude=e.at_filter_exclude,tstrings_no_cancel=e.no_cancel,tstrings_yes_delete=e.yes_delete,tstrings_yes=e.yes,tstrings_deleted=e.deleted,tstrings_cancelled=e.cancelled,tstrings_need_input=e.need_input,tstrings_install_package=e.install_package,tstrings_remove_package=e.remove_package,tstrings_update_package=e.update_package,tstrings_upload_package=e.upload_package,tstrings_upload_error=e.upload_error,tstr_bqe_add_url=e.bqe_add_url,tstr_bqe_name_url=e.bqe_name_url}function toggleFullRemote(){$("#symbolRemoteView").toggle(),$("#fullRemoteView").toggle()}function SetSpinner(){loadspinner=" \t<div class='page-loader-wrapper'> \t\t<div class='loader'> \t\t\t<div class='preloader'> \t\t\t\t<div class='spinner-layer pl--skinned'> \t\t\t\t\t<div class='circle-clipper left'> \t\t\t\t\t\t<div class='circle'></div> \t\t\t\t\t</div> \t\t\t\t\t<div class='circle-clipper right'> \t\t\t\t\t\t<div class='circle'></div> \t\t\t\t\t</div> \t\t\t\t</div> \t\t\t</div> \t\t\t<p>"+tstr_loading+"...</p> \t\t</div> \t</div>"}function listTimers(){$("#timerdlgcont").html(loadspinner).load("ajax/timers #timers")}function set_epg_modal_content(e){$("#editTimerForm").load("ajax/edittimer"),$("#epgmodalcontent").html($(e).find("#epgcards").html())}function open_epg_dialog(e,t){$("#epgmodalcontent").html(loadspinner);var i="ajax/epgdialog?sref="+encodeURIComponent(e);$.get(i,set_epg_modal_content)}function open_epg_similar_dialog(e,t){$("#epgmodalcontent").html(loadspinner);var i="ajax/epgdialog?sref="+encodeURIComponent(e)+"&eventid="+t;$.get(i,set_epg_modal_content)}function load_channelsepg(e){return $("#channel_epg_container").load(e),!1}function load_subcontent(e){return $("[id^=sub_content_container]").load(e),!1}function loadtvcontent(e){return $("[id^=tvcontent]").load(e),!1}function load_maincontent(e){return(lastcontenturl!=e||e.indexOf("screenshot")>-1||e.indexOf("boxinfo")>-1)&&($("#content_container").load(e),lastcontenturl=e),!1}function load_maincontent_spin_force(e){var t='<div id="content_main">'+loadspinner+"</div>";return $("#content_container").html(t).load(e),lastcontenturl=e,!1}function testPipStatus(){$.ajax({url:"api/pipinfo",dataType:"json",cache:!1,success:function(e){e.pip!=pip&&(pip=e.pip,buttonsSwitcher(e.pip))}})}$((function(){timeredit_initialized||$("#editTimerForm").load("ajax/edittimer"),$("#navbar-collapse").on("show.bs.modal",(function(e){$("#navbar-collapse").removeAttr("style")})),$("#navbar-collapse").on("hide.bs.modal",(function(e){$("#navbar-collapse").addAttr("style","width:100%")})),$("#TimerModal").on("show.bs.modal",(function(e){if(!$("#TimerModal").data("bs.modal").isShown){var t;1!==timerFormInitiated&&initTimerEditForm();try{var i=e.relatedTarget.closest("[data-metadata]");t={},null!=i?t=JSON.parse(e.relatedTarget.closest("[data-metadata]").dataset.metadata):(t.sref=e.relatedTarget.dataset.ref,t.id=e.relatedTarget.dataset.evid)}catch(e){console.log(e),t={}}t.sref&&t.id?addEditTimerEvent(t.sref,t.id):t.sref&&t.begin&&t.end?editTimer(t.sref,t.begin,t.end):addTimer()}})),$("#TimerModal").on("hidden.bs.modal",(function(e){})),autosize($("textarea.auto-growth")),$.VTiTools.epgsearch.activate(),$.VTiTools.moviesearch.activate(),$(document).keydown((function(e){(e.ctrlKey||e.cmdKey)&&70===e.keyCode&&(e.preventDefault(),$.VTiTools.epgsearch.showSearchBar()),(e.ctrlKey||e.cmdKey)&&69===e.keyCode&&(e.preventDefault(),$.VTiTools.epgsearch.showSearchBar()),(e.ctrlKey||e.cmdKey)&&77===e.keyCode&&(e.preventDefault(),$.VTiTools.moviesearch.showSearchBarMovie())})),VTiWebConfig(),setInterval((function(){getStatusInfo()}),3e3)}));var SSHelperObj=function(){var e;return{setup:function(){e=this,clearInterval(e.screenshotInterval),e.ssr_i=parseInt($("#ssr_i").val()),e.ssr_hd=$("#ssr_hd").is(":checked"),$("#dropdown").click((function(){testPipStatus()})),$("#screenshotbutton0").click((function(){testPipStatus(),grabScreenshot("all")})),$("#screenshotbutton1").click((function(){testPipStatus(),grabScreenshot("video")})),$("#screenshotbutton2").click((function(){testPipStatus(),grabScreenshot("osd")})),$("#screenshotbutton3").click((function(){testPipStatus(),grabScreenshot("pip")})),$("#screenshotbutton4").click((function(){testPipStatus(),grabScreenshot("lcd")})),$("button").click((function(){testPipStatus()})),$("#ssr_i").val(e.ssr_i),$("#screenshotspinner").addClass(GetLSValue("spinner","fa-spinner")),$("#ssr_hd").change((function(){testPipStatus(),e.ssr_hd=$("#ssr_hd").is(":checked"),webapi_execute("/api/setwebconfig?screenshot_high_resolution="+(e.ssr_hd?"true":"false")),grabScreenshot("auto")})),$("#ssr_i").change((function(){testPipStatus();var t=$("#ssr_i").val();webapi_execute("/api/setwebconfig?screenshot_refresh_time="+t),e.ssr_i=parseInt(t),$("#ssr_s").is(":checked")&&(clearInterval(e.screenshotInterval),e.setSInterval())})),$("#ssr_s").change((function(){testPipStatus();var t=$("#ssr_s").is(":checked");t?e.setSInterval():clearInterval(e.screenshotInterval),webapi_execute("/api/setwebconfig?screenshot_refresh_auto="+(t?"true":"false"))})),screenshotMode="all",grabScreenshot(screenshotMode),$("#ssr_s").is(":checked")&&e.setSInterval()},setSInterval:function(){e.screenshotInterval=setInterval((function(){testPipStatus(),grabScreenshot("auto")}),1e3*(e.ssr_i+1))}}},SSHelper=new SSHelperObj;function load_reboot_dialog(e,t){var i=loadspinner.replace("<p>"+tstr_loading+"...</p>","<p>"+tstr_loading+"...</p><p>"+t+"</p>");$("#responsivespinner").html(i)}function toggleLeftSideBar(){var e=$("body"),t=e.height(),i=$("#fullmaincontent");$("body").hasClass("ls-closed-manual")?(i.addClass("content"),i.removeClass("contentfull"),e.removeClass("ls-closed-manual"),$("#epgcard").height($("#leftsidemenu").height()-30+"px"),$("#topmenuheader,#mainfooter").show(),$("#togglefullscreen").html("fullscreen"),setTimeout((function(){load_tvcontent("ajax/multiepg?epgmode=tv")}),500)):(e.addClass("ls-closed-manual"),i.removeClass("content"),i.addClass("contentfull"),$("#epgcard").height(t+"px"),$("#topmenuheader,#mainfooter").hide(),$("#togglefullscreen").html("fullscreen_exit"),setTimeout((function(){load_tvcontent("ajax/multiepg?epgmode=tv")}),500))}function grabScreenshot(e){$("#screenshotimage").load((function(){$("#responsivespinnerscreenshot").hide()})),"auto"!=e?screenshotMode=e:e=screenshotMode,timestamp=(new Date).getTime(),SSHelper.ssr_hd?$("#screenshotimage").attr("src","/grab?format=jpg&mode="+e+"&t="+timestamp):$("#screenshotimage").attr("src","/grab?format=jpg&r=720&mode="+e+"&t="+timestamp),$("#screenshotimage").attr("style","max-height:60vh;"),"lcd"==e?$("#screenshotimage").attr("class","img-responsive center-block"):$("#screenshotimage").attr("class","img-responsive img-rounded center-block")}function setOSD(e){var t=current_ref=e.currservice_serviceref,i=current_name=e.currservice_station,a=(tstr_stream,tstr_stream+" ("+tstr_transcoded+"): "+i+"'><i class='material-icons'>phone_android</i></a>"),n="",r="",s="";if(i&&((t.startsWith("1:0:")||t.startsWith("1:134:")||t.startsWith("4097:0:"))&&($("#osd__current-event__name").html(e.currservice_name),t.startsWith("1:0:0")?$("#osd__current-service").html("[ Movies ]"):($("#osd__current-event__time__start").html(e.currservice_begin||""),$("#osd__current-event__time__end").html(e.currservice_end||""),$("#osd__current-service").html(i),$("#osd__current-event__epg").off("click").click((function(){open_epg_dialog(t,i)})),$("#osd__current-event").off("click").click((function(){loadeventepg(e.currservice_id,t,"/images/default_picon.png")}))),e.transcoding&&(t.startsWith("1:0:1")||t.startsWith("1:134:1"))&&(n="<a href='#' onclick=\"jumper8002('"+t+"', '"+i+"')\"; title='"+a)),t.startsWith("1:0:0")||t.startsWith("4097:0:")))if(""===e.currservice_filename)r="<a href='#' title='"+tstr_stream+": "+i+"'>"+i+"</a>";else{var o=e.currservice_filename.replaceAll("'","%27").replaceAll('"',"%22");r="<a href='/web/ts.m3u?file="+o+"' target='_blank' title='"+tstr_stream+": "+i+"'><i class='material-icons'>movie</i></a>",s="<a href='/#movies' onclick='load_maincontent(\"ajax/movies\");'><b>"+i+"&nbsp;&nbsp;</b></a>",e.transcoding&&(n="<a href='#' onclick=\"jumper8003('"+o+"')\"; title='"+a)}$("#osd__current-event__stream").attr("href","/web/stream.m3u?ref="+t+"&name="+encodeURIComponent(i)),$("#volume-slider, #osd__current-volume").val(e.volume),$("#responsive_osd_transcoding").html(n),$("#responsive_osd_stream").html(r),$("#responsive_osd_current").html(s),$("#responsive_osd_cur_event").html("");try{$(".channel-list__channel").removeClass("channel--active"),$("#sref-"+t.replace(/:/g,"_")).addClass("channel--active")}catch(e){}}function loadeventepg(e,t,i){channelpicon=void 0!==i?i:null;var a="ajax/event?idev="+e+"&sref="+encodeURIComponent(t);$("#eventdescriptionII").load(a)}function loadtimeredit(e,t){var i="ajax/event?idev="+e+"&sref="+encodeURIComponent(t);$("#eventdescriptionII").load(i)}function initTimerEdit(e,t){initTimerBQ(e,(function(){for(var e in $("#dirname").find("option").remove().end(),$("#dirname").append($("<option></option>").attr("value","None").text("Default")),_locations){var i=_locations[e];$("#dirname").append($("<option></option>").attr("value",i).text(i))}for(var e in $("#dirname").selectpicker("refresh"),$("#tagsnew").html(""),_tags){var a=_tags[e];$("#tagsnew").append("<input type='checkbox' name='"+a+"' value='"+a+"' id='tag_"+a+"'/><label for='tag_"+a+"'>"+a+"</label>")}$("#tagsnew > input").checkboxradio({icon:!1}),timeredit_initialized=!0,t()}))}function initTimerEditBegin(){$("#timerbegin").datetimepicker({format:"dd.mm.yy hh:ii",autoclose:!0,todayHighlight:!0,todayBtn:"linked",minuteStep:2,language:"de"}),$("#timerbegin").datetimepicker().on("changeDate",(function(e,t){""!=$("#timerend").val()&&$(this).datetimepicker("getDate")>$("#timerend").datetimepicker("getDate")&&showErrorMain(tstr_start_after_end)}))}function TimerConflict(e,t,i,a){var n="";e.sort((function(e,t){return e.begin-t.begin})),e.forEach((function(e){n+="<div class='row clearfix conflicting-timer'><div class='col-xs-12'> \t\t\t<div class='card'> \t\t\t\t<div class='header' style='padding: 10px 20px;'> \t\t\t\t\t<div class='row clearfix'> \t\t\t\t\t\t<div class='col-xs-12'>               <h2>                 <span role='button'>                   <a href='javascript:void(0);' onclick='toggleTimerStatus(\""+e.serviceref+'", "'+e.begin+'", "'+e.end+'"); this.closest(".conflicting-timer").classList.add("fade");\' class="link--skinned" title=\'Disable Timer\'>                     <i class=\'material-icons material-icons-centered material-icons-mg-right\'>alarm_off</i>                   </a>                 </span> \t\t\t\t\t\t\t  '+e.name+"                 <span style='opacity: 0.4;'> - "+e.servicename+"</span>               </h2> \t\t\t\t\t\t</div> \t\t\t\t\t</div> \t\t\t\t</div> \t\t\t\t<div class='body'> \t\t\t\t\t\t<div class='row clearfix'> \t\t\t\t\t\t\t<div class='col-xs-12' style='margin: 10px 0 0;'>                 <p>"+e.realbegin+" - "+e.realend+"</p>               </div> \t\t\t\t\t\t</div> \t\t\t\t\t</div> \t\t\t\t</div> \t\t\t</div> \t\t</div></div> \t\t"})),$(".modal").modal("hide"),$("#timerconflictmodal").html(n),$("#TimerConflictModal").modal("show")}function cbAddTimerEvent(e){e.state&&($(".event[data-id="+e.eventId+'][data-ref="'+e.sRef+'"] .timer').remove(),$(".event[data-id="+e.eventId+'][data-ref="'+e.sRef+'"] div:first').append('<div class="timer">'+tstr_timer+"</div>"),showErrorMain(tstr_timer_added,!0))}function addTimerEvent(e,t,i,a){var n="/api/timeraddbyeventid?sRef="+e+"&eventid="+t;i&&(n+="&eit=0&disabled=0&justplay=1&afterevent=3"),webapi_execute_result(n,(function(n,r,s){!n&&s?TimerConflict(s,e,t,i):void 0!==a?a({sRef:e,eventId:t,justplay:i,state:n,txt:r}):showErrorMain(n?tstr_timer_added:r,!0)}))}function addTimer(e,t,i,a){current_serviceref="",current_begin=-1,current_end=-1,servicename="";var n=-1,r=-1,s="",o="",c="",l=0,d=0;void 0!==e&&""!=e&&(n=e.begin,r=e.begin+e.duration,s=e.sref,servicename=e.channel,o=e.title,c=e.shortdesc,l=e.recording_margin_before,d=e.recording_margin_after);var m=$("#bouquet_select > optgroup").length,u=!1;void 0!==t&&(u="1:0:2:"==t.substring(0,6)),$("#cbtv").prop("checked",!u),$("#cbradio").prop("checked",u);var p=function(){void 0!==t&&void 0!==i&&(s=t,o=i,"undefined"===$("#bouquet_select").val(t)&&$("#bouquet_select").append($("<option></option>").attr("value",s).text(i))),$("#timername").val(o),$("#description").val(c),$("#dirname").val("None"),$("#enabled").prop("checked",!0),$("#allow_duplicate").prop("checked",!0),$("#autoadjust").prop("checked",!1),$("#justplay").prop("checked",!1),$("#afterevent").val(3);for(var e=0;e<7;e++)$("#day"+e).prop("checked",!1);$("#tagsnew > input").prop("checked",!1).checkboxradio("refresh");var a=-1!==n?new Date(1e3*(Math.round(n)-60*l)):new Date;$("#timerbegin").datetimepicker("setDate",a);var m=-1!==r?new Date(1e3*(Math.round(r)+60*d)):new Date(a.getTime()+36e5);$("#timerend").datetimepicker("setDate",m),$("#bouquet_select").val(s),$("#bouquet_select").trigger("chosen:updated"),setTimerEditFormTitle(tstr_add_timer)};if(!timeredit_initialized||m<2)initTimerEdit(u,p);else{var h=$("#bouquet_select option:last").val();u&&"1:0:2:"!==h.substring(0,6)?initTimerEdit(u,p):u||"1:0:2:"!=h.substring(0,6)?p():initTimerEdit(u,p)}}function editTimer(e,t,i){e=decodeURIComponent(e),current_serviceref=e,current_begin=t,current_end=i;var a=!1;void 0!==e&&(a="1:0:2:"==e.substring(0,6)),$("#cbtv").prop("checked",!a),$("#cbradio").prop("checked",a);var n=function(){timeredit_begindestroy&&(initTimerEditBegin(),timeredit_begindestroy=!1),$.ajax({url:"/api/timerlist",dataType:"json",success:function(a){if(a.result)for(var n in a.timers)if(timer=a.timers[n],timer.serviceref==e&&Math.round(timer.begin)==Math.round(t)&&Math.round(timer.end)==Math.round(i)){$("#timername").val(timer.name),$("#description").val(timer.description),$("#bouquet_select").val(timer.serviceref),$("#bouquet_select").trigger("chosen:updated"),timer.serviceref!==$("#bouquet_select").val()&&($("#bouquet_select").append($("<option></option>").attr("value",timer.serviceref).text(timer.servicename)),$("#bouquet_select").val(timer.serviceref)),$("#dirname").val(timer.dirname),timer.dirname!==$("#dirname").val()&&(current_location="<option value='"+timer.dirname+"'>"+timer.dirname+"</option>",$("#dirname").append(current_location),$("#dirname").val(timer.dirname)),$("#enabled").prop("checked",0==timer.disabled),$("#allow_duplicate").prop("checked",timer.allow_duplicate),$("#autoadjust").prop("checked",timer.autoadjust),$("#justplay").prop("checked",timer.justplay),$("#afterevent").val(timer.afterevent);for(var r=timer.repeated,s=0;s<7;s++)$("#day"+s).prop("checked",1==(1&r)),r>>=1;$("#tagsnew > input").prop("checked",!1);for(var o=timer.tags.split(" "),c=0;c<o.length;c++){var l=o[c].replace(/\(/g,"_").replace(/\)/g,"_").replace(/\'/g,"_");l.length>0&&($("#tag_"+l).length?$("#tag_"+l).prop("checked",!0).checkboxradio("refresh"):$("#tagsnew").append("<input type='checkbox' checked='checked' name='"+l+"' value='"+l+"' id='tag_"+l+"'/><label for='tag_"+l+"'>"+l+"</label>"))}$("#tagsnew > input").checkboxradio({icon:!1}),$("#timerbegin").datetimepicker("setDate",new Date(1e3*Math.round(timer.begin))),$("#timerend").datetimepicker("setDate",new Date(1e3*Math.round(timer.end)));var d=2===timer.state;d?($("#timerbegin").datetimepicker("destroy"),timeredit_begindestroy=!0,$("#timerbegin").addClass("ui-state-disabled"),$("#timername").addClass("ui-state-disabled"),$("#dirname option").not(":selected").attr("disabled","disabled"),$("#bouquet_select option").not(":selected").attr("disabled","disabled")):($("#timername").removeClass("ui-state-disabled"),$("#timerbegin").removeClass("ui-state-disabled"),$("#dirname option").removeAttr("disabled"),$("#bouquet_select option").removeAttr("disabled")),$("#timerbegin").prop("readonly",d),$("#timername").prop("readonly",d),void 0!==timer.vpsplugin_enabled&&(timer.vpsplugin_enabled,0)?(console.debug(timer.vpsplugin_enabled),$("#vpsplugin_enabled").prop("checked",timer.vpsplugin_enabled),$("#vpsplugin_safemode").prop("checked",!timer.vpsplugin_overwrite),$("#has_vpsplugin1").show(),checkVPS()):$("#has_vpsplugin1").hide(),void 0!==timer.always_zap?($("#always_zap1").show(),$("#always_zap").prop("checked",1==timer.always_zap),$("#justplay").prop("disabled",1==timer.always_zap)):$("#always_zap1").hide(),setTimerEditFormTitle(tstr_edit_timer+" - "+timer.name);break}}})};if(timeredit_initialized){var r=$("#bouquet_select option:last").val();a&&"1:0:2:"!==r.substring(0,6)?initTimerEdit(a,n):a||"1:0:2:"!=r.substring(0,6)?n():initTimerEdit(a,n)}else initTimerEdit(a,n)}function changeMoviesort(e){MLHelper.SortMovies(e),MLHelper.ChangeSort(e),MLHelper.ReadMovies(),lastcontenturl="",load_maincontent_spin("ajax/movies")}function changeMoviesortSearch(e){MLHelper.SortMovies(e),MLHelper.ChangeSort(e),MLHelper.ReadMovies(),load_maincontent_spin_force(lastcontenturl)}function initTimerEditForm(){1!==timerFormInitiated&&(timerFormInitiated=1,addTimer(),element=document.getElementById("editTimerForm"),$("#timereditmodal").html(element))}function setTimerEditFormTitle(e){$("#timerEditTitle").html(e)}function setVolume(e){$.ajax("web/vol?set=set"+e),getStatusInfo()}function toggleMute(){$.ajax("web/vol?set=mute"),getStatusInfo()}function CallEPGResponsive(e){load_tvcontent_spin(e)}function CallEPG(){$("#myepgbtn2").click((function(){$("#tvcontent").load("ajax/multiepg?epgmode=radio")})),$("#myepgbtn3").click((function(){$("#tvcontent").load("ajax/multiepg?epgmode=tv")})),$("#tvbutton").buttonset(),$("#tvcontent").load("ajax/multiepg?epgmode=tv")}function myEPGSearch(){var e=$("#epgSearchTVRadio").val(),t=$("#myepgbtn0").is(":checked")?"&full=1":"",i=$("#myepgbtn1").is(":checked")?"&bouquetsonly=1":"",a="ajax/epgdialog?sstr="+encodeURIComponent(e)+t+i,n=$(window).width()-100,r=$(window).height()-100,s={};s[tstr_close]=function(){$(this).dialog("close")},s[tstr_open_in_new_window]=function(){$(this).dialog("close"),open_epg_search_pop(e,t)},load_dm_spinner(a,tstr_epgsearch,n,r,s)}getStatusInfo=function(){$("#osd__connection").toggle(!navigator.onLine),navigator.onLine&&owif.api.getStatusInfo().then((function(e){var t="";if(1==e.muted?(mutestatus=1,t="<a href='#' onclick='toggleMute(); return false;'><i class='material-icons'>volume_off</i></a>"):(mutestatus=0,t="<a href='#' onclick='toggleMute(); return false;'><i class='material-icons'>volume_up</i></a>"),$("#responsive_mute_status").html(t),setOSD(e),"true"==e.isRecording){var i=e.Recording_list.split("\n"),a=0,n="";for(var r in i)""!=i[r]&&(a+=1,n+="<li> <a href='/#timers' onclick='load_maincontent(\"ajax/timers\");' data-dismiss='modal'>"+i[r]+"</a></li><hr />");$("#recmodalcontent").html(n),$("#osd__active-recordings .label-count").text(a).parent().show()}else $("#osd__active-recordings").hide();if("true"==e.isStreaming){var s=e.Streaming_list.split("\n"),o=0;for(var c in n="",s)""!=s[c]&&(o+=1,n+="<li>"+s[c]+"</li><hr/>");$("#streammodalcontent").html(n),$("#osd__active-streams .label-count").text(o).parent().show()}else $("#osd__active-streams").hide();$("body").toggleClass("standby-mode","true"===e.inStandby)}))},$.VTiTools={};var $searchBar=$(".search-bar-epg"),$searchBarMovie=$(".search-bar-movie");function gotEPGSearch(){var e=$("#epgsearchtext").val(),t=$("#myepgbtn0").is(":checked")?"&full=1":"",i=$("#myepgbtn1").is(":checked")?"&bouquetsonly=1":"",a="ajax/epgdialog?sstr="+encodeURIComponent(e)+t+i;$("#epgSearch").val(""),load_maincontent(a),lastcontenturl=""}function gotMovieSearch(){var e=$("#moviesearchtext").val(),t=$("#mymoviesearchbtn0").is(":checked")?"&short=1":"",i=$("#mymoviesearchbtn1").is(":checked")?"&extended=1":"",a="ajax/moviesearch?find="+encodeURIComponent(e)+t+i;$("#epgSearch").val(""),load_maincontent_spin_force(a)}function closeMessageModal(){$("#messageSentResponse").html("")}function sendModalMessage(){var e=$("#messageText").val(),t=$("#messageType").val(),i=$("#messageTimeout").val();$.ajax({url:"/api/message?text="+e+"&type="+t+"&timeout="+i,dataType:"json",cache:!1,success:function(e){$("#messageSentResponse").html('<div class="alert alert-info">'+e.message+"</div>"),0==t&&(MessageAnswerCounter=i,setTimeout(countdowngetMessage,1e3))}}),$("#messageText").val(""),$("#messageType").val(1),$("#messageType").selectpicker("refresh"),$("#messageTimeout").val("30"),$("#messageTimeout").removeClass("active"),$("#messageText").addClass("active")}function btn_saveTimer(){var e=moment($("#timerend").val(),"DD.MM.YYYY hh:mm").unix(),t=0;$('[name="repeated"]:checked').each((function(){t+=parseInt($(this).val())}));var i="";$('[name="tagsnew"]:checked').each((function(){""!=i&&(i+=" "),i+=$(this).val()}));var a={sRef:$("#bouquet_select").val(),end:e,name:$("#timername").val(),description:$("#description").val(),disabled:$("#enabled").is(":checked")?"0":"1",allow_duplicate:$("#allow_duplicate").is(":checked")?"1":"0",autoadjust:$("#autoadjust").is(":checked")?"1":"0",afterevent:$("#afterevent").val(),tags:i,repeated:t};if($("#always_zap").is(":checked")?(a.always_zap="1",a.justplay="0"):a.justplay=$("#justplay").is(":checked")?"1":"0","None"!=$("#dirname").val()&&(a.dirname=$("#dirname").val()),$("#has_vpsplugin1").is(":hidden")||(a.vpsplugin_enabled=$("#vpsplugin_enabled").is(":checked")?"1":"0",a.vpsplugin_overwrite=$("#vpsplugin_safemode").is(":checked")?"0":"1"),timeredit_begindestroy)a.begin=Math.round(current_begin);else{var n=moment($("#timerbegin").val(),"DD.MM.YYYY hh:mm").unix();a.begin=n}var r=!1;""==current_serviceref?$.ajax({async:!1,dataType:"json",cache:!1,url:"/api/timeradd?",data:a,success:function(e){if(e.result)r=!0;else if(e.conflicts){var t="Timer Conflicts:<br>";e.conflicts.forEach((function(e){t+=e.name+" / "+e.servicename+" / "+e.realbegin+" - "+e.realend+"<br>"})),showErrorMain(t)}else showErrorMain(e.message)}}):(a.channelOld=current_serviceref,a.beginOld=Math.round(current_begin),a.endOld=Math.round(current_end),$.ajax({async:!1,dataType:"json",cache:!1,url:"api/timerchange?",data:a,success:function(e){if(e.result)r=!0;else if(e.conflicts){var t="Timer Conflicts:<br>";e.conflicts.forEach((function(e){t+=e.name+" / "+e.servicename+" / "+e.realbegin+" - "+e.realend+"<br>"})),$("#error").text(t)}else $("#error").text(e.message)}})),r&&reloadTimers&&lastcontenturl.startsWith("ajax/timers")&&(lastcontenturl="",setTimeout((function(){load_maincontent("ajax/timers")}),500))}function VTiWebConfig(){$("#mymoviesearchbtn0").change((function(){var e=$("#mymoviesearchbtn0").is(":checked")?"1":"0";$.get("api/setvtiwebconfig?moviesearchshort="+e)})),$("#mymoviesearchbtn1").change((function(){var e=$("#mymoviesearchbtn1").is(":checked")?"1":"0";$.get("api/setvtiwebconfig?moviesearchextended="+e)})),$("#myepgbtn0").change((function(){var e=$("#myepgbtn0").is(":checked")?"1":"0";$.get("api/setvtiwebconfig?fullsearch="+e)})),$("#myepgbtn1").change((function(){var e=$("#myepgbtn1").is(":checked")?"1":"0";$.get("api/setvtiwebconfig?bqonly="+e)})),$("#remotegrabscreen1").change((function(){var e=$(this).is(":checked")?"1":"0";$.get("api/setvtiwebconfig?rcugrabscreen="+e)})),$("#remotecontrolview").change((function(){var e=$(this).is(":checked")?"1":"0";$.get("api/setvtiwebconfig?remotecontrolview="+e),toggleFullRemote()})),$("#minmovielist").change((function(){var e=$(this).is(":checked")?"1":"0";$.get("api/setvtiwebconfig?minmovielist="+e),lastcontenturl.startsWith("ajax/movies")&&load_maincontent_spin_force(lastcontenturl)})),$("#mintimerlist").change((function(){var e=$(this).is(":checked")?"1":"0";$.get("api/setvtiwebconfig?mintimerlist="+e),"ajax/timers"===lastcontenturl&&(lastcontenturl="",load_maincontent("ajax/timers"))})),$("#minepglist").change((function(){var e=$(this).is(":checked")?"1":"0";$.get("api/setvtiwebconfig?minepglist="+e)})),$("#zapstream").change((function(){var e=$(this).is(":checked")?"1":"0";$.get("api/setvtiwebconfig?zapstream="+e)})),$("#showpicons").change((function(){var e=$(this).is(":checked")?"1":"0";$.get("api/setvtiwebconfig?showpicons="+e),$("#showpiconbackground").prop("disabled",!e)})),$("#showpiconbackground").change((function(){var e=$(this).is(":checked")?"1":"0";$.get("api/setvtiwebconfig?showpiconbackground="+e)})),$("#showiptvchannelsinselection").change((function(){var e=$(this).is(":checked")?"1":"0";$.get("api/setvtiwebconfig?showiptvchannelsinselection="+e)})),$("#screenshotchannelname").change((function(){var e=$(this).is(":checked")?"1":"0";$.get("api/setvtiwebconfig?screenshotchannelname="+e)})),$("#thememodebtn").change((function(){var e=$(this).is(":checked")?$(this).val():"supabright";$("body").removeClass((function(e,t){return(t.match(/(^|\s)theme--\S+/g)||[]).join(" ")})),$(this).is(":checked")?$("body").addClass("theme--"+e):$("body").addClass("theme--supabright"),$.get("api/setthememode?themeMode="+e)})),$("#nownext_columns").change((function(){var e=$(this).is(":checked")?"1":"0";$.get("api/setvtiwebconfig?nownext_columns="+e)}))}function showErrorMain(e,t){var i="error";!0!==(t=void 0!==t?t:"False")&&"True"!==t&&"true"!==t||(i="success"),""!==e?swal("",e,i):$("#statuscont").hide()}function deleteTimer(e,t,i,a){var n=decodeURIComponent(a);swal({title:tstr_del_timer,text:n,type:"warning",showCancelButton:!0,confirmButtonColor:"#DD6B55",confirmButtonText:tstrings_yes_delete,cancelButtonText:tstrings_no_cancel,animation:"none"},(function(a){a&&webapi_execute("/api/timerdelete?sRef="+e+"&begin="+t+"&end="+i,(function(){$("#"+t+"-"+i).remove()}))}))}function deleteMovie(e,t,i){swal({title:tstr_del_recording,text:i,type:"warning",showCancelButton:!0,confirmButtonColor:"#DD6B55",confirmButtonText:tstrings_yes_delete,cancelButtonText:tstrings_no_cancel,closeOnConfirm:!1,animation:"none"},(function(a){a&&webapi_execute_movie("/api/moviedelete?sRef="+e,(function(e){e&&(swal(tstrings_deleted,i,"success"),$("#"+t).remove())}))}))}function renameMovie(e,t){swal({title:tstr_ren_recording,text:t,type:"input",showCancelButton:!0,closeOnConfirm:!1,animation:"none",inputPlaceholder:t,inputValue:t,input:"text"},(function(i){return!1!==i&&i!==t&&(""===i?(swal.showInputError(tstrings_need_input),!1):(webapi_execute_movie("/api/movierename?sRef="+e+"&newname="+i),void showErrorMain(i,!0)))}))}function closeSideBar(){var e=$("body");if(e.width()<$.AdminBSB.options.leftSideBar.breakpointWidth){var t=$("#leftsidebarin");e.addClass("ls-closed"),t.fadeIn()}else e.removeClass("ls-closed")}$.VTiTools.epgsearch={activate:function(){var e=this;$(".js-search-epg").on("click",(function(){e.showSearchBar()})),$searchBar.find(".close-search").on("click",(function(){e.hideSearchBar()})),$searchBar.find(".start-search").on("click",(function(){e.startSearch()})),$searchBar.find('input[type="text"]').on("keyup",(function(t){27==t.keyCode?e.hideSearchBar():13==t.keyCode&&e.startSearch()}))},showSearchBar:function(){$.VTiTools.moviesearch.hideSearchBarMovie(),$searchBar.addClass("open"),$searchBar.find('input[type="text"]').focus()},hideSearchBar:function(){$searchBar.removeClass("open"),$searchBar.find('input[type="text"]').val("")},startSearch:function(){$("body").hasClass("ls-closed-manual")&&toggleLeftSideBar(),gotEPGSearch(),this.hideSearchBar()}},$.VTiTools.moviesearch={activate:function(){var e=this;$(".js-search-movie").on("click",(function(){console.debug("xlkj"),e.showSearchBarMovie()})),$searchBarMovie.find(".close-search").on("click",(function(){e.hideSearchBarMovie()})),$searchBarMovie.find(".start-search").on("click",(function(){e.startSearchMovie()})),$searchBarMovie.find('input[type="text"]').on("keyup",(function(t){27==t.keyCode?e.hideSearchBarMovie():13==t.keyCode&&e.startSearchMovie()}))},showSearchBarMovie:function(){$.VTiTools.epgsearch.hideSearchBar(),$searchBarMovie.addClass("open"),$searchBarMovie.find('input[type="text"]').focus()},hideSearchBarMovie:function(){$searchBarMovie.removeClass("open"),$searchBarMovie.find('input[type="text"]').val("")},startSearchMovie:function(){$("body").hasClass("ls-closed-manual")&&toggleLeftSideBar(),gotMovieSearch(),this.hideSearchBarMovie()}};