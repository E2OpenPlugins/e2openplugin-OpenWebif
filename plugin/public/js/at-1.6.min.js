//******************************************************************************
//* at.js: openwebif Autotimer plugin
//* Version 1.6
//* License GPL V2
//* https://github.com/E2OpenPlugins/e2openplugin-OpenWebif/blob/master/LICENSE.txt
//*******************************************************************************
function toUnixDate(t){var e=t.split("."),r=new Date;return r.setFullYear(e[2],e[1]-1,e[0]),r.setHours(0),r.setMinutes(0),r.setSeconds(0),Math.floor(r.getTime()/1e3)}function initValues(){for(var t=$("#oafter"),e=$("#obefore"),r=$("#maxduration"),a=$("#counter"),i=$("#left"),n=0;100>n;n++){var s=n.toString();10>n&&(s="0"+s),t.append($("<option></option>").val(n).html(s)),e.append($("<option></option>").val(n).html(s)),a.append($("<option></option>").val(n).html(s)),i.append($("<option></option>").val(n).html(s))}for(var n=0;1e3>n;n++){var s=n.toString();10>n&&(s="0"+s),r.append($("<option></option>").val(n).html(s))}$("#oafter").val("5"),$("#obefore").val("5"),$("#maxduration").val("70");var o=new Date,c=$.datepicker.formatDate("dd.mm.yy",o);$("#after").val(c);var u=new Date;u.setDate(o.getDate()+7),c=$.datepicker.formatDate("dd.mm.yy",u),$("#before").val(c),$("#from").val("20:15"),$("#to").val("23:15"),$("#aefrom").val("20:15"),$("#aeto").val("23:15"),$("#after").datepicker({closeText:tstr_done,monthNames:[tstr_january,tstr_february,tstr_march,tstr_april,tstr_may,tstr_june,tstr_july,tstr_august,tstr_september,tstr_october,tstr_november,tstr_december],dayNames:[tstr_sunday,tstr_monday,tstr_tuesday,tstr_wednesday,tstr_thursday,tstr_friday,tstr_saturday,tstr_sunday],dayNamesMin:[tstr_su,tstr_mo,tstr_tu,tstr_we,tstr_th,tstr_fr,tstr_sa,tstr_su],dateFormat:"dd.mm.yy",onClose:function(t,e){""!=$("#after").val()&&$(this).datepicker("getDate")<$("#before").datepicker("getDate")?($("#error").text(tstr_start_after_end),$("#errorbox").show()):$("#errorbox").hide()}}),$("#before").datepicker({closeText:tstr_done,monthNames:[tstr_january,tstr_february,tstr_march,tstr_april,tstr_may,tstr_june,tstr_july,tstr_august,tstr_september,tstr_october,tstr_november,tstr_december],dayNames:[tstr_sunday,tstr_monday,tstr_tuesday,tstr_wednesday,tstr_thursday,tstr_friday,tstr_saturday,tstr_sunday],dayNamesMin:[tstr_su,tstr_mo,tstr_tu,tstr_we,tstr_th,tstr_fr,tstr_sa,tstr_su],dateFormat:"dd.mm.yy",onClose:function(t,e){""!=$("#before").val()&&$(this).datepicker("getDate")>$("#after").datepicker("getDate")?($("#error").text(tstr_start_after_end),$("#errorbox").show()):$("#errorbox").hide()}}),$(".date").each(function(t,e){$('<span style="display: inline-block">').addClass("ui-icon ui-icon-calendar").insertAfter(e).position({of:e,my:"right top",at:"right top+2"})}),$(".time").each(function(t,e){$('<span style="display: inline-block">').addClass("ui-icon ui-icon-clock").insertAfter(e).position({of:e,my:"right top",at:"right top+2"})}),$("#bouquets").chosen({disable_search_threshold:10,no_results_text:"Oops, nothing found!",width:"80%"}),$("#bouquets").chosen().change(function(){$("#bouquets").val($(this).val())}),$("#channels").chosen({disable_search_threshold:10,no_results_text:"Oops, nothing found!",width:"80%"}),$("#channels").chosen().change(function(){$("#channels").val($(this).val())}),$("#tags").chosen({disable_search_threshold:10,no_results_text:"Oops, nothing found!",width:"80%"}),$("#tags").chosen().change(function(){$("#tags").val($(this).val())})}function AddFilter(t,e,r){var a=$("#filterlist tr").length,i=$("#dummyfilter").clone(!0);i.show(),i.attr({id:"f"+a.toString(),name:"f"+a.toString()}),""!=t&&i.find(".FT").val(t),""!=e&&("dayofweek"==e?(i.find(".FM").val(e),i.find(".FI").hide(),i.find(".FS").show().val(r)):(i.find(".FM").val(e),i.find(".FS").hide(),i.find(".FI").show().val(r))),i.appendTo("#filterlist")}function timeFrameAfterCheck(){if($("#timeFrameAfter").is(":checked")===!0){var t=$("#after").datepicker("getDate"),e=new Date(t),r=new Date;r.setDate(e.getDate()+7),t=$.datepicker.formatDate("dd.mm.yy",r),$("#before").val(t),$("#beforeE").show()}else{var e=new Date(2038,0,1),t=$.datepicker.formatDate("dd.mm.yy",e);$("#before").val(t),$("#beforeE").hide()}}function checkValues(){$("#timeSpan").is(":checked")===!0?$("#timeSpanE").show():$("#timeSpanE").hide(),$("#timeSpanAE").is(":checked")===!0?$("#timeSpanAEE").show():$("#timeSpanAEE").hide(),$("#timeFrame").is(":checked")===!0?$("#timeFrameE").show():$("#timeFrameE").hide(),$("#timerOffset").is(":checked")===!0?$("#timerOffsetE").show():$("#timerOffsetE").hide(),$("#maxDuration").is(":checked")===!0?$("#maxDurationE").show():$("#maxDurationE").hide(),$("#Location").is(":checked")===!0?$("#LocationE").show():$("#LocationE").hide(),$("#Bouquets").is(":checked")===!0?$("#BouquetsE").show():$("#BouquetsE").hide(),$("#Channels").is(":checked")===!0?$("#ChannelsE").show():$("#ChannelsE").hide(),$("#Filter").is(":checked")===!0?$("#FilterE").show():$("#FilterE").hide(),""!=$("#afterevent").val()?$("#AftereventE").show():$("#AftereventE").hide(),"0"!=$("#counter").val()?$("#CounterE").show():$("#CounterE").hide(),$("#vps").is(":checked")===!0?$("#vpsE").show():$("#vpsE").hide()}function InitPage(){$("#timeSpan").click(function(){checkValues()}),$("#timeSpanAE").click(function(){checkValues()}),$("#timeFrame").click(function(){checkValues()}),$("#timeFrameAfter").click(function(){timeFrameAfterCheck()}),$("#timerOffset").click(function(){checkValues()}),$("#maxDuration").click(function(){checkValues()}),$("#Location").click(function(){checkValues()}),$("#Bouquets").click(function(){checkValues()}),$("#Channels").click(function(){checkValues()}),$("#Filter").click(function(){checkValues()}),$("#AddFilter").click(function(){AddFilter("","","")}),$("#afterevent").change(function(){checkValues()}),$("#counter").change(function(){checkValues()}),$("#vps").change(function(){checkValues()}),initValues(),checkValues(),getData(),$("#actions").buttonset(),$("#atbutton0").click(function(){addAT()}),$("#atbutton0").button({icons:{primary:"ui-icon-plus"}}),$("#atbutton1").click(function(){delAT()}),$("#atbutton1").button({icons:{primary:"ui-icon-minus"}}),$("#atbutton2").click(function(){reloadAT()}),$("#atbutton2").button({icons:{primary:"ui-icon-arrowrefresh-1-w"}}),$("#atbutton3").click(function(){saveAT()}),$("#atbutton3").button({icons:{primary:"ui-icon-disk"}}),$("#atbutton4").click(function(){parseAT()}),$("#atbutton5").click(function(){simulateAT()}),$("#atbutton6").click(function(){listTimers()}),$("#atbutton7").click(function(){getAutoTimerSettings()}),$("#errorbox").hide(),$("#simdlg").dialog({modal:!0,overlay:{backgroundColor:"#000",opacity:.5},autoOpen:!1,title:tstr_timerpreview,width:600,height:400}),$("#timerdlg").dialog({modal:!0,overlay:{backgroundColor:"#000",opacity:.5},autoOpen:!1,title:tstr_timerlist,width:600,height:400});var t={};t.Save=function(){setAutoTimerSettings(),$(this).dialog("close")},t.Cancel=function(){$(this).dialog("close")},$("#atsettingdlg").dialog({modal:!0,overlay:{backgroundColor:"#000",opacity:.5},autoOpen:!1,title:"AutoTimer Settings",width:600,height:400,buttons:t})}function isBQ(t){return t.indexOf("FROM BOUQUET")>-1&&0!=t.indexOf("1:134:1")}function Parse(){$("#atlist").empty();var t=[];if($(atxml).find("timer").each(function(){t.push($(this))}),t.sort(function(t,e){var r=t.attr("name"),a=e.attr("name");return r==a?0:r>a?1:-1}),$(t).each(function(){$("#atlist").append($("<li></li>").html($(this).attr("name")).addClass("ui-widget-content").data("id",$(this).attr("id")))}),at2add)addAT(at2add),at2add=null;else{var e=$("#atlist").find("li").first();e&&(FillAT(e.data("id")),e.addClass("ui-selected"))}}function isInArray(t,e){return t.indexOf(e)>=0?!0:!1}function getTags(){$.getJSON("/api/gettags",function(t){var e=t.tags,r="";$.each(e,function(t,e){r+="<option value='"+encodeURIComponent(e)+"'>"+e+"</option>"}),$("#tags").append(r),$("#tags").trigger("chosen:updated")})}function getAllServices(){$.getJSON("/api/getallservices",function(t){var e=t.services,r="",a="",i=[];$.each(e,function(t,e){var n=e.servicereference,s=e.servicename;a+="<option value='"+encodeURIComponent(n)+"'>"+e.servicename+"</option>";var o=e.subservices,c=[];$.each(o,function(t,e){var r=e.servicereference;isInArray(i,r)||(i.push(r),("1:0:"==r.substring(0,4)||"1:134:1"==r.substring(0,7))&&c.push("<option value='"+r+"'>"+e.servicename+"</option>"))}),c.length>0&&(r+="<optgroup label='"+s+"'>"+c.join("")+"</optgroup>")}),$("#channels").append(r),$("#channels").trigger("chosen:updated"),$("#bouquets").append(a),$("#bouquets").trigger("chosen:updated"),reloadAT()})}function getData(){getTags(),getAllServices()}function FillAT(t){$(atxml).find("defaults");$(atxml).find("timer").each(function(){$(this).attr("id")==t&&(CurrentAT=new AutoTimerObj($(this)),CurrentAT.UpdateUI())}),checkValues()}function AutoTimerObj(t){if(this.isNew=!1,this.MustSave=!1,this.id=t.attr("id"),this.enabled="yes"==t.attr("enabled"),this.name=t.attr("name"),this.name||(this.name=""),this.match=t.attr("match"),this.match||(this.match=""),this.searchType="partial",t.attr("searchType")&&(this.searchType=t.attr("searchType")),this.searchCase="insensitive",t.attr("searchCase")&&(this.searchCase=t.attr("searchCase")),this.justplay="0",t.attr("justplay")&&(this.justplay=t.attr("justplay")),this.overrideAlternatives="1"==t.attr("overrideAlternatives"),this.timeSpan=!1,t.attr("from")&&t.attr("to")&&(this.from=t.attr("from"),this.to=t.attr("to"),this.timeSpan=!0),this.maxduration=null,t.attr("maxduration")&&(this.maxduration=t.attr("maxduration")),t.attr("after")&&t.attr("before")){var e=parseInt(t.attr("after")),r=new Date(1e3*e),a=$.datepicker.formatDate("dd.mm.yy",r);this.after=a,e=parseInt(t.attr("before")),r=new Date(1e3*e),a=$.datepicker.formatDate("dd.mm.yy",r),this.before=a,this.timeFrame=!0}else this.before=null,this.after=null,this.timeFrame=!1;if(this.avoidDuplicateDescription="0",t.attr("avoidDuplicateDescription")&&(this.avoidDuplicateDescription=t.attr("avoidDuplicateDescription")),this.location=null,t.attr("location")&&(this.location=t.attr("location")),this.timerOffset=!1,t.attr("offset")){var i=t.attr("offset").split(","),n=i[0],s=i[1];"undefined"==typeof s?(this.timerOffsetAfter=n,this.timerOffsetBefore=n):(this.timerOffsetAfter=s,this.timerOffsetBefore=n),this.timerOffset=!0}var o=t.find("afterevent");this.afterevent=null,o.text()&&(this.afterevent=o.text(),o.attr("from")&&o.attr("to")?(this.aftereventfrom=o.attr("from"),this.aftereventto=o.attr("to")):(this.aftereventfrom=null,this.aftereventto=null));var c=[],n=[];t.find("e2service").each(function(){var t=$(this).find("e2servicereference").text();isBQ(t)?n.push(encodeURIComponent(t)):c.push(t)}),this.Channels=c.slice(),this.Bouquets=n.slice(),n=[],t.find("e2tags").each(function(){var t=$(this).text();n.push(encodeURIComponent(t))}),this.Tags=n.slice();var u=[];t.find("include").each(function(){u.push({t:"include",w:$(this).attr("where"),v:$(this).text()})}),t.find("exclude").each(function(){u.push({t:"exclude",w:$(this).attr("where"),v:$(this).text()})}),this.Filters=u.slice(),this.counter=t.attr("counter"),this.counter||(this.counter="0"),this.left=t.attr("left"),this.left||(this.left="0"),this.counterFormat=t.attr("counterFormat"),this.counterFormat||(this.counterFormat=""),this.vps=!1,this.vpso=!1,"yes"===t.attr("vps_enabled")&&(this.vps=!0,"yes"===t.attr("vps_overwrite")&&(this.vpso=!0)),this.series_labeling=!1,"yes"===t.attr("series_labeling")&&(this.series_labeling=!0)}function addAT(t){if(CurrentAT&&CurrentAT.isNew)return void showError("please save the current autotimer first");var e=1;$(atxml).find("timer").each(function(){var t=parseInt($(this).attr("id"));t>=e&&(e=t+1)});var r=tstr_timernewname,a=e.toString(),i='<timers><timer name="'+r+'" match="'+r+'" enabled="yes" id="'+a+'" justplay="0" overrideAlternatives="1"></timer></timers>';"undefined"!=typeof t&&(i='<timers><timer name="'+t.name+'" match="'+t.name+'" enabled="yes" id="'+a+'" from="'+t.from+'" to="'+t.to+'"',i+=' searchType="exact" searchCase="sensitive" justplay="0" overrideAlternatives="1" ',i+="><e2service><e2servicereference>"+t.sref+"</e2servicereference><e2servicename>"+t.sname+"</e2servicename></e2service>",i+="</timer></timers>");var n=$.parseXML(i);$(n).find("timer").each(function(){$("#atlist").append($("<li></li>").html($(this).attr("name")).addClass("ui-widget-content").data("id",$(this).attr("id"))),CurrentAT=new AutoTimerObj($(this)),CurrentAT.isNew=!0,CurrentAT.MustSave=!0,CurrentAT.UpdateUI()}),$("#atlist").find("li").each(function(){$(this).data("id")==a?$(this).addClass("ui-selected"):$(this).removeClass("ui-selected")})}function delAT(){if(CurrentAT&&!CurrentAT.isNew){if(confirm(tstr_del_autotimer+" ("+CurrentAT.name+") ?")===!1)return;$.ajax({type:"GET",url:"/autotimer/remove?id="+CurrentAT.id,dataType:"xml",success:function(t){var e=$(t).find("e2state").first(),r=$(t).find("e2statetext").first();showError(r.text(),e),readAT()},error:function(t,e,r){showError(t.responseText)}})}}function readAT(){CurrentAT=null,$.ajax({type:"GET",url:"/autotimer",dataType:"xml",success:function(t){atxml=t,Parse()},error:function(t,e,r){showError(t.responseText)}})}function saveAT(){if(CurrentAT){var t="/autotimer/edit?";CurrentAT.enabled=$("#enabled").is(":checked"),CurrentAT.name=$("#name").val(),CurrentAT.match=$("#match").val(),CurrentAT.searchType=$("#searchType").val(),CurrentAT.searchCase=$("#searchCase").val(),CurrentAT.justplay=$("#justplay").val(),CurrentAT.overrideAlternatives=$("#overrideAlternatives").is(":checked"),CurrentAT.timeSpan=$("#timeSpan").is(":checked"),CurrentAT.avoidDuplicateDescription=$("#avoidDuplicateDescription").val(),CurrentAT.timeSpan=$("#timeSpan").is(":checked"),CurrentAT.from=$("#from").val(),CurrentAT.to=$("#to").val(),CurrentAT.timerOffset=$("#timerOffset").is(":checked"),CurrentAT.before=$("#before").val(),CurrentAT.after=$("#after").val(),$("#maxDuration").is(":checked")?CurrentAT.maxduration=$("#maxduration").val():CurrentAT.maxduration=null,$("#Location").is(":checked")?CurrentAT.location=$("#location").val():CurrentAT.location=null,CurrentAT.timeFrame=$("#timeFrame").is(":checked"),CurrentAT.timerOffsetBefore=$("#obefore").val(),CurrentAT.timerOffsetAfter=$("#oafter").val(),CurrentAT.afterevent=$("#afterevent").val(),CurrentAT.aftereventfrom=$("#aefrom").val(),CurrentAT.aftereventto=$("#aeto").val(),CurrentAT.Bouquets=$("#bouquets").chosen().val(),CurrentAT.Channels=$("#channels").chosen().val();var e=[];if($.each($("#filterlist tr"),function(t,r){var a=$(r);if("dummyfilter"!==a.prop("id")){var i=a.find(".FT"),n=a.find(".FM"),s=a.find(".FI"),o=a.find(".FS"),c=a.find(".FR");e.push(c.is(":checked")===!1?"dayofweek"===n.val()?{t:i.val(),w:n.val(),v:o.val()}:{t:i.val(),w:n.val(),v:s.val()}:{t:i.val(),w:n.val(),v:""})}}),CurrentAT.Filters=e.slice(),CurrentAT.Tags=$("#tags").chosen().val(),CurrentAT.counter=$("#counter").val(),CurrentAT.left=$("#left").val(),CurrentAT.counterFormat=$("#counterFormat").val(),CurrentAT.vps=$("#vps").is(":checked"),CurrentAT.vpso=!$("#vpssm").is(":checked"),CurrentAT.series_labeling=$("#series_labeling").is(":checked"),t+="match="+encodeURIComponent(CurrentAT.match),t+="&name="+encodeURIComponent(CurrentAT.name),t+="&enabled=",t+=CurrentAT.enabled?"1":"0",t+="&justplay="+CurrentAT.justplay,t+="&setEndtime=",t+=CurrentAT.setEndtime?"1":"0",t+="&searchCase="+CurrentAT.searchCase,t+="&overrideAlternatives=",t+=CurrentAT.overrideAlternatives?"1":"0",t+="&avoidDuplicateDescription="+CurrentAT.avoidDuplicateDescription,CurrentAT.location&&(t+="&location="+encodeURIComponent(CurrentAT.location)),t+="&searchType="+CurrentAT.searchType,t+="&maxduration=",CurrentAT.maxduration&&CurrentAT.maxduration>-1&&(t+=CurrentAT.maxduration),CurrentAT.timerOffset&&(t+=CurrentAT.timerOffsetAfter>-1&&CurrentAT.timerOffsetBefore>-1?"&offset="+CurrentAT.timerOffsetBefore+","+CurrentAT.timerOffsetAfter:"&offset="),t+=CurrentAT.timeSpan?"&timespanFrom="+CurrentAT.from+"&timespanTo="+CurrentAT.to:"&timespanFrom=&timespanTo=",t+=CurrentAT.timeFrame?"&before="+toUnixDate(CurrentAT.before)+"&after="+toUnixDate(CurrentAT.after):"&before=&after=",CurrentAT.Tags&&CurrentAT.Tags.length>0?$.each(CurrentAT.Tags,function(e,r){t+="&tag="+r}):t+="&tag=",t+="&services=",CurrentAT.Channels&&CurrentAT.Channels.length>0){var r=[];$.each(CurrentAT.Channels,function(t,e){r.push(encodeURIComponent(e))}),t+=r.join(",")}t+="&bouquets=",CurrentAT.Bouquets&&CurrentAT.Bouquets.length>0&&(t+=CurrentAT.Bouquets.join(",")),CurrentAT.Filters&&CurrentAT.Filters.length>0&&$.each(CurrentAT.Filters,function(e,r){var a="&";"exclude"===r.t&&(a+="!"),a+=r.w,a+="=",a+="dayofweek"===r.w?r.v:encodeURIComponent(r.v),t+=a}),CurrentAT.vps||(CurrentAT.vpo=!1),t+="&vps_enabled=",t+=CurrentAT.vps?"1":"0",t+="&vps_overwrite=",t+=CurrentAT.vpso?"1":"0",t+="&series_labeling=",t+=CurrentAT.series_labeling?"1":"0",CurrentAT.isNew||(t+="&id="+CurrentAT.id),$.ajax({type:"GET",url:t,dataType:"xml",success:function(t){var e=$(t).find("e2state").first(),r=$(t).find("e2statetext").first();showError(r.text(),e.text()),readAT()},error:function(t,e,r){showError(t.responseText)}})}}function simulateAT(){$("#simdlg").dialog("open"),$("#simtb").append("<tr><td COLSPAN=5>"+loadspinner+"</td></tr>"),$.ajax({type:"GET",url:"/autotimer/simulate",dataType:"xml",success:function(t){var e=[];$(t).find("e2simulatedtimer").each(function(){var t="<tr>";t+="<td>"+$(this).find("e2autotimername").text()+"</td>",t+="<td>"+$(this).find("e2name").text()+"</td>",t+="<td>"+$(this).find("e2servicename").text()+"</td>";var r=$(this).find("e2timebegin").text(),a=new Date(1e3*Math.round(r));r=a.getMonth()+1+"/"+a.getDate()+"/"+a.getFullYear()+" "+a.getHours()+":"+a.getMinutes(),t+="<td>"+r+"</td>",r=$(this).find("e2timeend").text(),a=new Date(1e3*Math.round(r)),r=a.getMonth()+1+"/"+a.getDate()+"/"+a.getFullYear()+" "+a.getHours()+":"+a.getMinutes(),t+="<td>"+r+"</td>",t+="</tr>",e.push(t)}),$("#simtb").empty(),$(e).each(function(t,e){$("#simtb").append(e)}),0===e.length&&$("#simtb").append("<tr><td COLSPAN=5>NO Timer found</td></tr>")},error:function(t,e,r){showError(t.responseText)}})}function parseAT(){$.ajax({type:"GET",url:"/autotimer/parse",dataType:"xml",success:function(t){var e=$(t).find("e2state").first(),r=$(t).find("e2statetext").first();showError(r.text(),e.text())},error:function(t,e,r){showError(t.responseText)}})}function reloadAT(){showError(""),readAT(),$("#atlist").selectable({selected:function(t,e){$("#atlist .ui-selected").map(function(){FillAT($(this).data("id"))})}})}function listTimers(){$("#timerdlg").dialog("open"),$("#timerdlgcont").html(loadspinner).load("ajax/timers #timers",function(){$("#timerdlgcont #timers .moviecontainer_main .moviecontainer_right div a:first").hide()})}function getAutoTimerSettings(){$.ajax({type:"GET",url:"/autotimer/get",dataType:"xml",success:function(t){$(t).find("e2setting").each(function(){var t=$(this).find("e2settingname").text(),e=$(this).find("e2settingvalue").text();0===t.indexOf("config.plugins.autotimer.")&&(t=t.substring(25),"True"===e?$("#ats_"+t).prop("checked",!0):"False"===e?$("#ats_"+t).prop("checked",!1):$("#ats_"+t).val(e))}),$("#atsettingdlg").dialog("open")},error:function(t,e,r){showError(t.responseText)}})}function setAutoTimerSettings(){var t="/autotimer/set?&autopoll=";t+=$("#ats_autopoll").is(":checked")?"true":"",t+="&interval="+$("#ats_interval").val(),t+="&try_guessing=",t+=$("#ats_try_guessing").is(":checked")?"true":"",t+="&disabled_on_conflict=",t+=$("#ats_disabled_on_conflict").is(":checked")?"true":"",t+="&addsimilar_on_conflict=",t+=$("#ats_addsimilar_on_conflict").is(":checked")?"true":"",t+="&show_in_extensionsmenu=",t+=$("#ats_show_in_extensionsmenu").is(":checked")?"true":"",t+="&fastscan=",t+=$("#ats_fastscan").is(":checked")?"true":"",t+="&notifconflict=",t+=$("#ats_notifconflict").is(":checked")?"true":"",t+="&notifsimilar=",t+=$("#ats_notifsimilar").is(":checked")?"true":"",t+="&maxdaysinfuture="+$("#ats_maxdaysinfuture").val(),t+=$("#ats_add_autotimer_to_tags").is(":checked")?"true":"",t+="&add_autotimer_to_tags="+$("#ats_add_autotimer_to_tags").val(),t+=$("#ats_add_name_to_tags").is(":checked")?"true":"",t+="&add_name_to_tags="+$("#ats_add_name_to_tags").val(),t+="&refresh="+$("#ats_refresh").val(),t+="&editor="+$("#ats_editor").val(),$.ajax({type:"GET",url:t,dataType:"xml",success:function(t){var e=$(t).find("e2state").first(),r=$(t).find("e2statetext").first();showError(r.text(),e.text())},error:function(t,e,r){showError(t.responseText)}})}function showError(t,e){e="undefined"!=typeof e?e:"False",$("#success").text(""),$("#error").text(""),"True"===e?$("#success").text(t):$("#error").text(t),""!==t?$("#errorbox").show():$("#errorbox").hide()}var atxml,CurrentAT=null;AutoTimerObj.prototype.UpdateUI=function(){if($("#enabled").prop("checked",this.enabled),$("#name").val(this.name),$("#match").val(this.match),$("#searchType").val(this.searchType),$("#searchCase").val(this.searchCase),$("#justplay").val(this.justplay),$("#overrideAlternatives").prop("checked",this.overrideAlternatives),$("#timeSpan").prop("checked",this.timeSpan),$("#at_name").html("("+this.name+")"),this.timeSpan&&($("#from").val(this.from),$("#to").val(this.to)),this.maxduration?($("#maxDuration").prop("checked",!0),$("#maxduration").val(this.maxduration)):$("#maxDuration").prop("checked",!1),$("#timeFrame").prop("checked",this.timeFrame),this.timeFrame){$("#after").val(this.after),$("#before").val(this.before);var t=$("#before").datepicker("getDate"),e=new Date(2038,0,1);e>t?($("#timeFrameAfter").prop("checked",!0),$("#beforeE").show()):($("#timeFrameAfter").prop("checked",!1),$("#beforeE").hide())}$("#avoidDuplicateDescription").val(this.avoidDuplicateDescription),this.location?($("#location").val(this.location),this.location!==$("#location").val()&&(current_location="<option value='"+this.location+"'>"+this.location+"</option>",$("#location").append(current_location),$("#location").val(this.location)),$("#Location").prop("checked",!0)):$("#Location").prop("checked",!1),$("#timerOffset").prop("checked",this.timerOffset),this.timerOffset&&($("#oafter").val(this.timerOffsetAfter),$("#obefore").val(this.timerOffsetBefore)),$("#timeSpanAE").prop("checked",!1),$("#afterevent").val(""),this.afterevent&&($("#afterevent").val(this.afterevent),this.aftereventfrom&&this.aftereventto&&($("#aefrom").val(this.aftereventfrom),$("#aeto").val(this.aftereventto),$("#timeSpanAE").prop("checked",!0))),$("#channels").val(null),$("#bouquets").val(null),$.each(this.Bouquets,function(t,e){$('#bouquets option[value="'+e+'"]').prop("selected",!0)}),$.each(this.Channels,function(t,e){$('#channels option[value="'+e+'"]').prop("selected",!0)}),$("#Bouquets").prop("checked",this.Bouquets.length>0),$("#Channels").prop("checked",this.Channels.length>0),$("#tags").val(null),$.each(this.Tags,function(t,e){$('#tags option[value="'+e+'"]').prop("selected",!0)}),$("#bouquets").trigger("chosen:updated"),$("#channels").trigger("chosen:updated"),$("#tags").trigger("chosen:updated");var r=$("#filterlist tr").length;if(r>1)for(var a=1;r>a;a++)$("#f"+a.toString()).remove();var i=0;$.each(this.Filters,function(t,e){i++,AddFilter(e.t,e.w,e.v)}),$("#Filter").prop("checked",i>0),$("#counter").val(this.counter),$("#left").val(this.left),$("#counterFormat").val(this.counterFormat),$("#vps").prop("checked",this.vps),$("#vpssm").prop("checked",!this.vpso),$("#series_labeling").prop("checked",this.series_labeling),checkValues()};
