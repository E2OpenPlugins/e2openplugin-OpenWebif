function toUnixDate(e){var t=e.split("."),e=new Date;return e.setFullYear(t[2],t[1]-1,t[0]),e.setHours(0),e.setMinutes(0),e.setSeconds(0),Math.floor(e.getTime()/1e3)}function addZero(e){return e=e<10?"0"+e:e}function isBQ(e){return-1<e.indexOf("FROM BOUQUET")&&0!=e.indexOf("1:134:1")}function isAlter(e){return 0==e.indexOf("1:134:1")}(new function(){var c;return{setup:function(){c=this,$("#er_begin").val("22:30"),$("#er_end").val("6:30"),$("#er_begin").timepicker(),$("#er_end").timepicker(),$("#bouquets").chosen({disable_search_threshold:10,no_results_text:"Oops, nothing found!",width:"100%"}),$("#bouquets").chosen().change(function(){$("#bouquets").val($(this).val()),c.er_bqchchanged=!0}),$("#channels").chosen({disable_search_threshold:10,no_results_text:"Oops, nothing found!",width:"100%"}),$("#channels").chosen().change(function(){$("#channels").val($(this).val()),c.er_bqchchanged=!0}),$(".chosen-container .chosen-drop").addClass("ui-widget-content"),"eggplant"!=theme&&"vader"!=theme||$(".chosen-container .chosen-drop").css("background-image","none"),c.getAllServices(),$("#actions").buttonset(),$("#epgrbutton0").click(function(){c.reloadEPGR()}),$("#epgrbutton0").button({icons:{primary:"ui-icon-arrowrefresh-1-w"}}),$("#epgrbutton1").click(function(){c.saveEPGR()}),$("#epgrbutton1").button({icons:{primary:"ui-icon-disk"}}),$("#epgrbutton2").click(function(){c.DoRefresh()}),$("#statuscont").hide()},getAllServices:function(){niptv=EPGRnoiptv?"&noiptv=1":"",$.ajax({url:"/api/getallservices?nolastscanned=1"+niptv,dataType:"json",success:function(e){JSON.stringify(e);e=e.services;FillAllServices(e,!1,function(e,t){$("#channels").append(e),$("#channels").trigger("chosen:updated"),$("#bouquets").append(t),$("#bouquets").trigger("chosen:updated"),c.reloadEPGR()})}})},reloadEPGR:function(){c.showError(""),$.ajax({type:"GET",url:"/epgrefresh",dataType:"xml",success:function(e){c.readEPGR2(e)},error:function(e,t,n){c.showError(e.responseText)}})},readEPGR2:function(t){var n,r;c.er_hasAutoTimer=!1,$.ajax({type:"GET",url:"/epgrefresh/get",dataType:"xml",success:function(e){$(e).find("e2setting").each(function(){var e=$(this).find("e2settingname").text(),t=$(this).find("e2settingvalue").text();0===e.indexOf("config.plugins.epgrefresh.")?(e=e.substring(26),"True"===t?$("#er_"+e).prop("checked",!0):"False"===t?$("#er_"+e).prop("checked",!1):"begin"===e?n=t:"end"===e?r=t:"interval_seconds"==e?(c.binterval_in_seconds=!0,$("#er_interval").val(t)):"interval"==e?(c.binterval_in_seconds=!1,$("#er_interval").val(t)):$("#er_"+e).val(t)):"hasAutoTimer"===e&&"True"===t&&(c.er_hasAutoTimer=!0)}),c.UpdateCHBQ(t,n,r)},error:function(e,t,n){c.showError(e.responseText)}})},UpdateCHBQ:function(e,t,n){var r=parseInt(t),s=new Date(1e3*r),a=addZero(s.getHours()),t=addZero(s.getMinutes());$("#er_begin").val(a+":"+t),r=parseInt(n),a=addZero((s=new Date(1e3*r)).getHours()),t=addZero(s.getMinutes()),$("#er_end").val(a+":"+t);var i=[],o=[];$(e).find("e2service").each(function(){var e=$(this).find("e2servicereference").text();isBQ(e)?o.push(encodeURIComponent(e)):isAlter(e)?i.push(encodeURIComponent(e)):i.push(e)});t=i.slice(),e=o.slice();$("#channels").val(null),$("#bouquets").val(null),$.each(e,function(e,t){$('#bouquets option[value="'+t+'"]').prop("selected",!0)}),$.each(t,function(e,t){$('#channels option[value="'+t+'"]').prop("selected",!0)}),$("#bouquets").trigger("chosen:updated"),$("#channels").trigger("chosen:updated"),c.er_bqchchanged=!1,c.binterval_in_seconds?($("#lbls").show(),$("#lblm").hide()):($("#lblm").show(),$("#lbls").hide()),c.er_hasAutoTimer?$("#er_hasAT").show():$("#er_hasAT").hide()},saveEPGR:function(){var e="/epgrefresh/set?&enabled=";e+=$("#er_enabled").is(":checked")?"true":"",e+="&enablemessage=",e+=$("#er_enablemessage").is(":checked")?"true":"",$("#er_ebegin").is(":checked")&&(e+="&begin="+toUnixDate($("#er_begin").val())),$("#er_eend").is(":checked")&&(e+="&end="+toUnixDate($("#er_end").val())),e+="&delay_standby="+$("#er_delay_standby").val(),e+="&afterevent=",e+=$("#er_afterevent").is(":checked")?"true":"",e+="&force=",e+=$("#er_force").is(":checked")?"true":"",e+="&wakeup=",e+=$("#er_wakeup").is(":checked")?"true":"",e+="&adapter="+$("#er_adapter").val(),c.er_hasAutoTimer&&(e+="&inherit_autotimer=",e+=$("#er_inherit_autotimer").is(":checked")?"true":"",e+="&parse_autotimer="+$("#er_parse_autotimer").val()),c.binterval_in_seconds?e+="&interval_seconds="+$("#er_interval").val():e+="&interval="+$("#er_interval").val(),$.ajax({type:"GET",url:e,dataType:"xml",success:function(e){var t=$(e).find("e2state").first(),e=$(e).find("e2statetext").first();c.showError(e.text(),t.text()),t&&c.SaveCHBQ()},error:function(e,t,n){c.showError(e.responseText)}})},SaveCHBQ:function(){var n,e,t;!1!==c.er_bqchchanged&&(n="",t=$("#bouquets").chosen().val(),(e=$("#channels").chosen().val())&&0<e.length&&$.each(e,function(e,t){isAlter(t)?n+="&sref="+t:n+="&sref="+encodeURIComponent(t)}),t&&0<t.length&&$.each(t,function(e,t){n+="&sref="+t}),t="/epgrefresh/add?multi=1",""!=n&&(t+=n,$.ajax({type:"GET",url:t,dataType:"xml",success:function(e){var t=$(e).find("e2state").first(),e=$(e).find("e2statetext").first();c.showError(e.text(),t.text())},error:function(e,t,n){c.showError(e.responseText)}})))},DoRefresh:function(){$.ajax({type:"GET",url:"/epgrefresh/refresh",dataType:"xml",success:function(e){var t=$(e).find("e2state").first(),e=$(e).find("e2statetext").first();c.showError(e.text(),t.text())},error:function(e,t,n){c.showError(e.responseText)}})},showError:function(e,t){t=void 0!==t?t:"False",$("#statustext").text(""),!0===t||"True"===t||"true"===t?($("#statusbox").removeClass("ui-state-error").addClass("ui-state-highlight"),$("#statusicon").removeClass("ui-icon-alert").addClass("ui-icon-info")):($("#statusbox").removeClass("ui-state-highlight").addClass("ui-state-error"),$("#statusicon").removeClass("ui-icon-info").addClass("ui-icon-alert")),$("#statustext").text(e),""!==e?$("#statuscont").show():$("#statuscont").hide()}}}).setup();