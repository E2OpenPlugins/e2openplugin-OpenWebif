//******************************************************************************
//* openwebif.js: openwebif base module
//* Version 2.7
//******************************************************************************
//* Copyright (C) 2011-2016 E2OpenPlugins
//*
//* License GPL V2
//* https://github.com/E2OpenPlugins/e2openplugin-OpenWebif/blob/master/LICENSE.txt
//*******************************************************************************
function initJsTranslation(e){tstr_add_timer=e.add_timer,tstr_cancel=e.cancel,tstr_close=e.close,tstr_del_timer=e.delete_timer_question,tstr_del_autotimer=e.at_delete_autotimer_question,tstr_del_recording=e.delete_recording_question,tstr_ren_recording=e.rename_recording_question,tstr_done=e.done,tstr_edit_timer=e.edit_timer,tstr_hour=e.hour,tstr_save=e.save,tstr_minute=e.minute,tstr_nothing_play=e.nothing_play,tstr_now=e.now,tstr_on=e.on,tstr_reboot_box=e.reboot_box,tstr_rec_status=e.rec_status,tstr_restart_gui=e.restart_gui,tstr_standby=e.standby,tstr_start_after_end=e.start_after_end,tstr_time=e.time,tstr_zap_to=e.zap_to,tstr_january=e.month_01,tstr_february=e.month_02,tstr_march=e.month_03,tstr_april=e.month_04,tstr_may=e.month_05,tstr_june=e.month_06,tstr_july=e.month_07,tstr_august=e.month_08,tstr_september=e.month_09,tstr_october=e.month_10,tstr_november=e.month_11,tstr_december=e.month_12,tstr_monday=e.monday,tstr_tuesday=e.tuesday,tstr_wednesday=e.wednesday,tstr_thursday=e.thursday,tstr_friday=e.friday,tstr_saturday=e.saturday,tstr_sunday=e.sunday,tstr_mo=e.mo,tstr_tu=e.tu,tstr_we=e.we,tstr_th=e.th,tstr_fr=e.fr,tstr_sa=e.sa,tstr_su=e.su,tstr_loading=e.loading,tstr_stream=e.stream,tstr_transcoded=e.transcoded,tstr_send_message=e.send_message,tstr_sent_wait=e.sent_wait,tstr_epgsearch=e.epgsearch,tstr_bqe_del_channel_question=e.bqe_del_channel_question,tstr_bqe_del_bouquet_question=e.bqe_del_bouquet_question,tstr_bqe_name_bouquet=e.bqe_name_bouquet,tstr_bqe_name_marker=e.bqe_name_marker,tstr_bqe_rename_bouquet=e.bqe_rename_bouquet,tstr_bqe_rename_marker=e.bqe_rename_marker,tstr_bqe_filename=e.bqe_filename,tstr_bqe_restore_question=e.bqe_restore_question,tstr_timerlist=e.timer_list,tstr_timerpreview=e.timer_preview,tstr_timernewname=e.timer_newname,tstr_open_in_new_window=e.open_in_new_window,tstr_error_load_page=e.tstr_error_load_page,tstr_timer_added=e.tstr_timer_added,tstr_event_not_found=e.tstr_event_not_found,tstr_channel=e.channel,tstr_end=e.begin,tstr_begin=e.end}function wait_for_openwebif(){var e=window.setInterval(function(){webapi_execute("/api/statusinfo",function(){window.clearInterval(e),$("#modaldialog").dialog("close"),location.reload()})},2e3)}function handle_power_state_dialog(e){var t=0,n=loadspinner.replace("'spinner'","'spinner1'");$("#modaldialog").dialog("close"),2===e?(load_reboot_dialog(n,tstr_reboot_box),wait_for_openwebif(),t=1e3):3===e&&(load_reboot_dialog(n,tstr_restart_gui),wait_for_openwebif(),t=1e3),setTimeout(function(){webapi_execute("api/powerstate?newstate="+e)},t)}function load_reboot_dialog(e,t){$("#modaldialog").html(e).dialog({modal:!0,title:t,autoOpen:!0,width:"auto",height:"auto",open:function(){$("#modaldialog").css("overflow","hidden")},close:function(){$(this).dialog("destroy"),$("#modaldialog").html("")}})}function load_dm_spinner(e,t,n,r,i){var a="auto",o="auto";"undefined"!=typeof n&&(a=n),"undefined"!=typeof r&&(o=r),$("#modaldialog").html(loadspinner).dialog({modal:!0,title:t,autoOpen:!0,width:a,height:o,buttons:i,create:function(e){$(e.target).parent().css("position","fixed")},close:function(){$(this).dialog("destroy"),$("#modaldialog").html("")},open:function(){$.ajax({url:e,success:function(e){$("#modaldialog").html(e)},error:function(){$("#modaldialog").html(tstr_error_load_page)}}),$(this).siblings(".ui-dialog-buttonpane").find("button:eq(0)").focus()}})}function load_dm(e,t,n,r){var i={};i[tstr_close]=function(){$(this).dialog("close")};var a="auto",o="auto";"undefined"!=typeof n&&(a=n),"undefined"!=typeof r&&(o=r),$.ajax({url:e,success:function(e){$("#modaldialog").html(e).dialog({modal:!0,title:t,autoOpen:!0,width:a,height:o,buttons:i,close:function(){$(this).dialog("destroy"),$("#modaldialog").html("")},open:function(){$(this).siblings(".ui-dialog-buttonpane").find("button:eq(0)").focus()}})},error:function(){alert(tstr_error_load_page)}})}function load_message_dm(e,t){var n={};n[tstr_send_message]=function(){sendMessage()},n[tstr_cancel]=function(){$(this).dialog("close")},$.ajax({url:e,success:function(e){$("#modaldialog").html(e).dialog({modal:!0,title:t,autoOpen:!0,width:"auto",buttons:n,close:function(){$(this).dialog("destroy"),$("#modaldialog").html("")}})}})}function dialog_notyet(){return $("#dialog").dialog("open"),!1}function load_tvcontent(e){return $("#tvcontent").load(e),!1}function load_tvcontent_spin(e){return $("#tvcontent").html(loadspinner).load(e),!1}function load_maincontent(e){return(lastcontenturl!=e||e.indexOf("screenshot")>-1||e.indexOf("timer")>-1||e.indexOf("boxinfo")>-1)&&($("#content_container").load(e),lastcontenturl=e),!1}function load_maincontent_spin(e){if(lastcontenturl!=e){var t='<div id="content_main" style="min-height: 500px;">'+loadspinner+"</div>";$("#content_container").html(t).load(e),lastcontenturl=e}return!1}function webapi_execute(e,t){$.ajax({url:e,cache:!1,async:!1}).done(function(){"undefined"!=typeof t&&t()});return!1}function toggle_chan_des(e,t,n){var r="ajax/eventdescription?sref="+escape(t)+"&idev="+e,i="#"+n;$(i).load(r),$(i).slideToggle(200)}function open_epg_dialog(e,t){var n="ajax/epgdialog?sref="+escape(e),r=$(window).width()-100,i=$(window).height()-100,a={};a[tstr_close]=function(){$(this).dialog("close")},a[tstr_open_in_new_window]=function(){$(this).dialog("close"),open_epg_pop(e)},load_dm_spinner(n,t,r,i,a)}function open_epg_search_dialog(){var e=$("#epgSearch").val(),t=GetLSValue("epgsearchtype",!1)?"&full=1":"",n="ajax/epgdialog?sstr="+encodeURIComponent(e)+t;$("#epgSearch").val("");var r=$(window).width()-100,i=$(window).height()-100,a={};a[tstr_close]=function(){$(this).dialog("close")},a[tstr_open_in_new_window]=function(){$(this).dialog("close"),open_epg_search_pop(e,t)},load_dm_spinner(n,tstr_epgsearch,r,i,a)}function _epg_pop(e){$.popupWindow(e,{height:$(window).height(),width:$(window).width(),toolbar:!1,scrollbars:!0})}function open_epg_search_pop(e,t){_epg_pop("ajax/epgpop?sstr="+encodeURIComponent(e)+t)}function open_epg_pop(e){_epg_pop("ajax/epgpop?sref="+escape(e))}function TimerConflict(e){var t="<div class='tbltc'><div><div>Name</div><div>"+tstr_channel+"</div><div>"+tstr_end+"</div><div>"+tstr_begin+"</div></div>";e.forEach(function(e){t+="<div><div>"+e.name+"</div><div>"+e.servicename+"</div><div>"+e.realbegin+"</div><div>"+e.realend+"</div></div>"}),t+="</div>";var n={};n[tstr_close]=function(){$(this).dialog("close")},$("<div></div>").dialog({modal:!0,height:500,width:600,autoOpen:!0,title:"Timer Conflicts",open:function(){$(this).html(t)},buttons:n})}function webapi_execute_result(e,t){$.ajax({async:!1,url:e,cache:!1,success:function(e){result=$.parseJSON(e),"undefined"!=typeof t&&(result?t(result.result,result.message,result.conflicts):t(!1,"error"))}})}function addTimerEvent(e,t,n){var r="/api/timeraddbyeventid?sRef="+e+"&eventid="+t;n&&(r+="&eit=0&disabled=0&justplay=1&afterevent=3"),webapi_execute_result(r,function(r,i,a){!r&&a?TimerConflict(a,e,t,n):alert(r?tstr_timer_added:i)})}function addEditTimerEvent(e,t){var n="/api/event?sref="+e+"&idev="+t;$.ajax({url:n,dataType:"json",success:function(e){"undefined"!=typeof e&&"undefined"!=typeof e.event?addTimer(e.event):alert(tstr_event_not_found)},error:function(){}})}function addAutoTimerEvent(e,t,n,r,i){at2add={name:n,from:r,to:i,sref:e,sname:t},lastcontenturl="",$("#compressmepg").is(":visible")&&CompressMEPG(),$("#modaldialog").hasClass("ui-dialog-content")&&($("#modaldialog").dialog("destroy"),$("#modaldialog").html("")),$("#eventdescription").hasClass("ui-dialog-content")&&($("#eventdescription").dialog("destroy"),$("#eventdescription").html("")),load_maincontent("ajax/at")}function delTimerEvent(e,t){var n="/api/event?sref="+e+"&idev="+t;$.ajax({url:n,dataType:"json",success:function(n){if("undefined"!=typeof n&&"undefined"!=typeof n.event){var r=n.event.begin-60*n.event.recording_margin_before,i=n.event.begin+n.event.duration+60*n.event.recording_margin_after,a=decodeURIComponent(n.event.title);confirm(tstr_del_timer+": "+a)===!0&&webapi_execute("/api/timerdelete?sRef="+e+"&begin="+r+"&end="+i,function(){$(".event[data-id="+t+"] .timer").remove()})}else alert(tstr_event_not_found)},error:function(){}})}function toggleTimerStatus(e,t,n){var r="/api/timertogglestatus?",i={sRef:e,begin:t,end:n};$.ajax({url:r,dataType:"json",data:i,success:function(r){$("#img-"+t+"-"+n+" > i").each(function(){$(this).data("ref")==e&&($(this).removeClass("fa-square-o"),$(this).removeClass("fa-check-square-o"),$(this).addClass(r.disabled?"fa-square-o":"fa-check-square-o"))})},error:function(){}})}function deleteTimer(e,t,n,r){var i=decodeURIComponent(r);confirm(tstr_del_timer+": "+i)===!0&&webapi_execute("/api/timerdelete?sRef="+e+"&begin="+t+"&end="+n,function(){$("#"+t+"-"+n).remove()})}function cleanupTimer(){webapi_execute("/api/timercleanup",function(){load_maincontent("/ajax/timers")})}function renameMovie(e,t){var n=prompt(tstr_ren_recording,t);n&&n!=t&&webapi_execute("/api/movierename?sRef="+e+"&newname="+n)}function deleteMovie(e,t,n){confirm(tstr_del_recording+": "+n)===!0&&(webapi_execute("/api/moviedelete?sRef="+e),$("#"+t).remove())}function playRecording(e){var t=e.replace(/-/g,"%2D").replace(/_/g,"%5F").replace(/\//g,"%2F");console.debug(t);var n="/api/zap?sRef="+t;webapi_execute(n,function(){$("#osd").html(" "),$("#osd_bottom").html(" ")})}function zapChannel(e,t){var n="/api/zap?sRef="+escape(e);webapi_execute(n,function(){$("#osd").html(tstr_zap_to+": "+t),$("#osd_bottom").html(" ")})}function toggleStandby(){shiftbutton&&webapi_execute("api/set_powerup_without_waking_tv"),webapi_execute("api/powerstate?newstate=0"),setTimeout(getStatusInfo,1500)}function setOSD(e){var t=current_ref=e.currservice_serviceref,n=current_name=e.currservice_station;if(n){var r="<div id='osdicon'>",i=tstr_stream+": "+n+"'><i class='fa fa-desktop'></i></a>",a=tstr_stream+" ("+tstr_transcoded+"): "+n+"'><i class='fa fa-mobile'></i></a>",o="<span class='osdch'>"+n+"</span></a>&nbsp;&nbsp;",s=o+e.currservice_begin+" - "+e.currservice_end+"&nbsp;&nbsp;";-1!==t.indexOf("1:0:1")||-1!==t.indexOf("1:134:1")?(e.transcoding?(r+="<a href='#' onclick=\"jumper8001('"+t+"', '"+n+"')\"; title='"+i,r+="<a href='#' onclick=\"jumper8002('"+t+"', '"+n+"')\"; title='"+a):r+="<a target='_blank' href='/web/stream.m3u?ref="+t+"&name="+n+"' title='"+i,r+="</div>",$("#osd").html(r+"<a href='#' onClick='load_maincontent(\"ajax/tv\");return false;'>"+s+"<a style='text-decoration:none;' href=\"#\" onclick=\"open_epg_pop('"+t+"')\" title='"+e.currservice_fulldescription+"'>"+e.currservice_name+"</a>")):-1!==t.indexOf("1:0:2")||-1!==t.indexOf("1:134:2")?(r+="<a target='_blank' href='/web/stream.m3u?ref="+t+"&name="+n+"' title='"+i,r+="</div>",$("#osd").html(r+"<a href='#' onClick='load_maincontent(\"ajax/radio\");return false;'>"+s+"<a style='text-decoration:none;' href=\"#\" onclick=\"open_epg_pop('"+t+"')\" title='"+e.currservice_fulldescription+"'>"+e.currservice_name+"</a>")):-1!==t.indexOf("1:0:0")?(e.transcoding?(r+="<a href='#' onclick=\"jumper80('"+e.currservice_filename+"')\"; title='"+i,r+="<a href='#' onclick=\"jumper8003('"+e.currservice_filename+"')\"; title='"+a):r+="<a target='_blank' href='/web/ts.m3u?file="+e.currservice_filename+"' title='"+i,r+="</div>",$("#osd").html(r+s+e.currservice_name)):$("#osd").html(s+e.currservice_name),$("#osd_bottom").html(e.currservice_description)}else $("#osd").html(tstr_nothing_play),$("#osd_bottom").html("")}function getStatusInfo(){$.ajax({url:"/api/statusinfo",dataType:"json",cache:!1,success:function(e){$("#slider").slider("value",e.volume),$("#amount").val(e.volume),1==e.muted?(mutestatus=1,$("#volimage").attr("src","/images/volume_mute.png")):(mutestatus=0,$("#volimage").attr("src","/images/volume.png")),setOSD(e);var t="",n=tstr_standby;"true"!==e.inStandby&&(t=" checked",n=tstr_on);var r="";"true"==e.isRecording&&(r="<a href='#' onClick='load_maincontent(\"ajax/timers\"); return false;'><div title='"+tstr_rec_status+e.Recording_list+"' class='led-box'><div class='led-red'></div></div></a>"),r+="<div class='pwrbtncontout'><div class='pwrbtncont' title='"+n+"'><label class='label pwrbtn'><input type='checkbox' "+t+" id='pwrbtn' onchange='toggleStandby();return true;' /><div class='pwrbtn-control'></div></label></div></div>",$("#osd_status").html(r)},error:function(){$("#osd, #osd_bottom").html("")}})}function grabScreenshot(e){$("#screenshotspinner").show(),$("#screenshotimage").load(function(){$("#screenshotspinner").hide()}),"auto"!=e?screenshotMode=e:e=screenshotMode,timestamp=(new Date).getTime(),GetLSValue("ssr_hd",!1)?$("#screenshotimage").attr("src","/grab?format=jpg&mode="+e+"&timestamp="+timestamp):$("#screenshotimage").attr("src","/grab?format=jpg&r=720&mode="+e+"&timestamp="+timestamp),$("#screenshotimage").attr("width",720)}function getMessageAnswer(){$.ajax({url:"/api/messageanswer",dataType:"json",cache:!1,success:function(e){$("#messageSentResponse").html(e.message)}})}function countdowngetMessage(){return MessageAnswerCounter--,3>MessageAnswerCounter?void getMessageAnswer():($("#messageSentResponse").html(tstr_sent_wait+" "+MessageAnswerCounter),void setTimeout(countdowngetMessage,1e3))}function sendMessage(){var e=$("#messageText").val(),t=$("#messageType").val(),n=$("#messageTimeout").val();$.ajax({url:"/api/message?text="+e+"&type="+t+"&timeout="+n,dataType:"json",cache:!1,success:function(e){$("#messageSentResponse").html(e.message),0==t&&(MessageAnswerCounter=n,setTimeout(countdowngetMessage,1e3))}})}function toggleMenu(e){var t="#leftmenu_expander_"+e,n="#leftmenu_container_"+e;$(t).hasClass("ui-icon-caret-1-w")?($(t).removeClass("ui-icon-caret-1-w"),$(t).addClass("ui-icon-caret-1-s"),$(n).show("fast"),webapi_execute("/api/expandmenu?name="+e)):($(t).addClass("ui-icon-caret-1-w"),$(t).removeClass("ui-icon-caret-1-s"),$(n).hide("fast"),webapi_execute("/api/collapsemenu?name="+e))}function callScreenShot(){GetLSValue("remotegrabscreen",!0)&&("ajax/screenshot"==lastcontenturl?grabScreenshot(screenshotMode):load_maincontent("ajax/screenshot"))}function pressMenuRemote(e){var t="/api/remotecontrol?"+(shiftbutton?"type=long&":"")+"command="+e;webapi_execute(t),grabTimer>0&&clearTimeout(grabTimer),grabTimer=setTimeout("callScreenShot()",1e3)}function toggleFullRemote(){$("#menucontainer").toggle(),$("#remotecontainer").toggle()}function saveConfig(e,t){webapi_execute("/api/saveconfig?key="+escape(e)+"&value="+escape(t)),"config.usage.setup_level"==e&&$("#content_container").load(lastcontenturl)}function numberTextboxKeydownFilter(e){46!=e.keyCode&&8!=e.keyCode&&9!=e.keyCode&&(e.keyCode<48||e.keyCode>57)&&(e.keyCode<96||e.keyCode>105)&&e.preventDefault()}function initTimerBQ(e){var t="/api/getallservices";1==e&&(t+="?type=radio"),$.ajax({async:!1,url:t,success:function(e){if(services=$.parseJSON(e),services.result){$("#bouquet_select").find("option").remove().end();for(var t in services.services){service=services.services[t];for(var n in service.subservices)subservice=service.subservices[n],$("#bouquet_select").append($("<option></option>").attr("value",subservice.servicereference).text(subservice.servicename))}}}})}function initTimerEdit(e){initTimerBQ(e),$("#dirname").find("option").remove().end(),$("#dirname").append($("<option></option>").attr("value","None").text("Default"));for(var t in _locations){var n=_locations[t];$("#dirname").append($("<option></option>").attr("value",n).text(n))}$("#tagsnew").html("");for(var t in _tags){var r=_tags[t];$("#tagsnew").append("<input type='checkbox' name='tagsnew' value='"+r+"' id='tag_"+r+"'/><label for='tag_"+r+"'>"+r+"</label>")}$("#tagsnew").buttonset(),timeredit_initialized=!0}function loadLocations(){_locations=[],$.ajax({url:"/api/getlocations",success:function(e){var t=$.parseJSON(e);t.result&&(_locations=t.locations)}})}function loadTags(){_tags=[],$.ajax({url:"/api/gettags",success:function(e){var t=$.parseJSON(e);t.result&&(_tags=t.tags)}})}function checkVPS(){$("#vpsplugin_enabled").is(":checked")?($("#vpsplugin_safemode").show(),$("#has_vpsplugin2").show()):($("#vpsplugin_safemode").hide(),$("#has_vpsplugin2").hide())}function initTimerEditBegin(){$("#timerbegin").datetimepicker({timeText:tstr_time,hourText:tstr_hour,minuteText:tstr_minute,currentText:tstr_now,closeText:tstr_done,monthNames:[tstr_january,tstr_february,tstr_march,tstr_april,tstr_may,tstr_june,tstr_july,tstr_august,tstr_september,tstr_october,tstr_november,tstr_december],dayNames:[tstr_sunday,tstr_monday,tstr_tuesday,tstr_wednesday,tstr_thursday,tstr_friday,tstr_saturday,tstr_sunday],dayNamesMin:[tstr_su,tstr_mo,tstr_tu,tstr_we,tstr_th,tstr_fr,tstr_sa,tstr_su],dateFormat:"dd.mm.yy",timeFormat:"HH:mm",onClose:function(){""!=$("#timerend").val()&&$(this).datetimepicker("getDate")>$("#timerend").datetimepicker("getDate")?($("#error").text(tstr_start_after_end),$("#errorbox").show()):$("#errorbox").hide()}})}function editTimer(e,t,n){e=decodeURI(e),current_serviceref=e,current_begin=t,current_end=n;var r=!1;if("undefined"!=typeof e&&(r="1:0:2:"==e.substring(0,6)),$("#cbtv").prop("checked",!r),$("#cbradio").prop("checked",r),timeredit_initialized){var i=$("#bouquet_select option:last").val();r&&"1:0:2:"!==i.substring(0,6)&&initTimerEdit(r),r||"1:0:2:"!=i.substring(0,6)||initTimerEdit(r)}else initTimerEdit(r);timeredit_begindestroy&&(initTimerEditBegin(),timeredit_begindestroy=!1),$.ajax({url:"/api/timerlist",success:function(r){if(timers=$.parseJSON(r),timers.result)for(var i in timers.timers)if(timer=timers.timers[i],timer.serviceref==e&&Math.round(timer.begin)==Math.round(t)&&Math.round(timer.end)==Math.round(n)){$("#timername").val(timer.name),$("#description").val(timer.description),$("#bouquet_select").val(timer.serviceref),timer.serviceref!==$("#bouquet_select").val()&&($("#bouquet_select").append($("<option></option>").attr("value",timer.serviceref).text(timer.servicename)),$("#bouquet_select").val(timer.serviceref)),$("#dirname").val(timer.dirname),timer.dirname!==$("#dirname").val()&&(current_location="<option value='"+timer.dirname+"'>"+timer.dirname+"</option>",$("#dirname").append(current_location),$("#dirname").val(timer.dirname)),$("#enabled").prop("checked",0==timer.disabled),$("#justplay").prop("checked",timer.justplay),$("#afterevent").val(timer.afterevent),$("#errorbox").hide();for(var a=timer.repeated,o=0;7>o;o++)$("#day"+o).attr("checked",1==(1&a)),a>>=1;$("#repeatdays").buttonset("refresh"),$("#tagsnew").find("input").attr("checked",!1);for(var s=timer.tags.split(" "),c=0;c<s.length;c++)$("#tag_"+s[c]).attr("checked",!0);$("#tagsnew").buttonset("refresh"),$("#timerbegin").datetimepicker("setDate",new Date(1e3*Math.round(timer.begin))),$("#timerend").datetimepicker("setDate",new Date(1e3*Math.round(timer.end)));var d=2===timer.state;d?($("#timerbegin").datetimepicker("destroy"),timeredit_begindestroy=!0,$("#timerbegin").addClass("ui-state-disabled"),$("#timername").addClass("ui-state-disabled"),$("#dirname option").not(":selected").attr("disabled","disabled"),$("#bouquet_select option").not(":selected").attr("disabled","disabled")):($("#timername").removeClass("ui-state-disabled"),$("#timerbegin").removeClass("ui-state-disabled"),$("#dirname option").removeAttr("disabled"),$("#bouquet_select option").removeAttr("disabled")),$("#timerbegin").prop("readonly",d),$("#timername").prop("readonly",d),"undefined"!=typeof timer.vpsplugin_enabled?($("#vpsplugin_enabled").prop("checked",timer.vpsplugin_enabled),$("#vpsplugin_safemode").prop("checked",!timer.vpsplugin_overwrite),$("#has_vpsplugin1").show(),checkVPS()):$("#has_vpsplugin1").hide(),"undefined"!=typeof timer.always_zap?($("#always_zap1").show(),$("#always_zap").prop("checked",1==timer.always_zap),$("#justplay").prop("disabled",1==timer.always_zap)):$("#always_zap1").hide(),openTimerDlg(tstr_edit_timer+" - "+timer.name);break}}})}function addTimer(e,t,n){current_serviceref="",current_begin=-1,current_end=-1,servicename="";var r=-1,i=-1,a="",o="",s="",c=0,d=0;"undefined"!=typeof e&&""!=e&&(r=e.begin,i=e.begin+e.duration,a=e.sref,servicename=e.channel,o=e.title,s=e.shortdesc,c=e.recording_margin_before,d=e.recording_margin_after);var l=$("#bouquet_select > option").length,u=!1;if("undefined"!=typeof t&&(u="1:0:2:"==t.substring(0,6)),$("#cbtv").prop("checked",!u),$("#cbradio").prop("checked",u),!timeredit_initialized||2>l)initTimerEdit(u);else{var m=$("#bouquet_select option:last").val();u&&"1:0:2:"!==m.substring(0,6)&&initTimerEdit(u),u||"1:0:2:"!=m.substring(0,6)||initTimerEdit(u)}"undefined"!=typeof t&&"undefined"!=typeof n&&(a=t,o=n,"undefined"===$("#bouquet_select").val(t)&&$("#bouquet_select").append($("<option></option>").attr("value",a).text(n))),$("#timername").val(o),$("#description").val(s),$("#dirname").val("None"),$("#enabled").prop("checked",!0),$("#justplay").prop("checked",!1),$("#afterevent").val(3),$("#errorbox").hide();for(var p=0;7>p;p++)$("#day"+p).attr("checked",!1);$("#repeatdays").buttonset("refresh"),$("#tagsnew").find("input").attr("checked",!1),$("#tagsnew").buttonset("refresh");var _=-1!==r?new Date(1e3*(Math.round(r)-60*c)):new Date;$("#timerbegin").datetimepicker("setDate",_);var f=-1!==i?new Date(1e3*(Math.round(i)+60*d)):new Date(_.getTime()+36e5);$("#timerend").datetimepicker("setDate",f),$("#bouquet_select").val(a),a!==$("#bouquet_select").val()&&"undefined"!=typeof servicename&&""!=servicename&&($("#bouquet_select").append($("<option></option>").attr("value",a).text(servicename)),$("#bouquet_select").val(a)),openTimerDlg(tstr_add_timer)}function openTimerDlg(e){$("#editTimerForm").dialog("open"),$("#editTimerForm").dialog("option","title",e)}function InitAccordeon(e){$(e).accordion({active:!0,animate:!1,activate:function(e,t){t.oldPanel.empty(),t.oldPanel.html(tstr_loading+" ..."),t.newPanel.load(t.newHeader.find("a").attr("id"))},heightStyle:"content",collapsible:!0})}function RefreshMEPG(){var e="",t=GetLSValue("lastmbq","");""!=t&&(e="?bref="+t),$("#tvcontent").html(loadspinner).load("ajax/multiepg"+e,function(){ExpandMEPG()})}function ExpandMEPG(){$("#expandmepg").hide(),$("#compressmepg").show(),$("#refreshmepg").show(),$("#header").hide(),$("#leftmenu").hide(),$("#content").css("margin-left","5px"),$("#tvcontentmain > #toolbar-header").hide(),$("#tbl1body").height("100%"),$("#tvcontent").css("height","100%"),$("#tvcontentmain").css("height","950px"),fixTableHeight()}function CompressMEPG(){$("#refreshmepg").hide(),$("#expandmepg").show(),$("#compressmepg").hide(),$("#header").show(),$("#leftmenu").show(),$("#content").css("margin-left","185px"),$("#tvcontentmain > #toolbar-header").show(),$("#tvcontent").css("height","730px"),$("#tvcontentmain").css("height","800px"),fixTableHeight()}function mainresize(){if(console.log("WH"+$(window).height()+"TVH"+$("#tvcontentmain").height()),$("#tvcontentmain"))try{fixTableHeight()}catch(e){}}function InitBouquets(e){var t="";e===!0?($("#btn0").click(function(){$("#expandmepg").hide(),$("#tvcontent").html(loadspinner).load("ajax/current")}),$("#btn5").click(function(){var e="",t=GetLSValue("lastmbq","");""!=t&&(e="?bref="+t),$("#tvcontent").html(loadspinner).load("ajax/multiepg"+e),$("#expandmepg").show()})):(t="?stype=radio",$("#btn0").click(function(){$("#tvcontent").html(loadspinner).load("ajax/current"+t)})),$("#btn1").click(function(){$("#expandmepg").hide(),$("#tvcontent").html(loadspinner).load("ajax/bouquets"+t)}),$("#btn2").click(function(){$("#expandmepg").hide(),$("#tvcontent").html(loadspinner).load("ajax/providers"+t)}),$("#btn3").click(function(){$("#expandmepg").hide(),$("#tvcontent").load("ajax/satellites"+t)}),$("#btn4").click(function(){$("#expandmepg").hide(),$("#tvcontent").html(loadspinner).load("ajax/channels"+t)}),$("#tvbutton").buttonset();if(e===!0){var n=window.location.href.toLowerCase().split("#");if(window.location.hash="","tv"==n[1]){if("mepg"==n[2]||"mepgfull"==n[2])return mepgdirect=0,"mepgfull"==n[2]&&(mepgdirect=1),void $("#btn5").click();if("current"==n[2])return void $("#btn0").click()}}$("#tvcontent").load("ajax/bouquets"+t),"pepper-grinder"==theme&&$("#tvcontent").addClass("ui-state-active")}function getWinSize(e){e||(e=window);var t={};return"undefined"!=typeof e.innerWidth?(t.screenWidth=e.screen.width,t.screenHeight=e.screen.height):(t.screenWidth=0,t.screenHeight=0),t}function getDeviceType(){var e=getWinSize(),t=e.screenHeight>e.screenWdith?e.screenHeight:e.screenWidth;return 500>t?"phone":"tab"}function getOSType(){var e=navigator.userAgent;return e.indexOf("iPod")>-1||e.indexOf("iPhone")>-1||e.indexOf("iPad")>-1||e.indexOf("ipod")>-1||e.indexOf("iphone")>-1||e.indexOf("ipad")>-1?"ios":e.indexOf("Android")>-1||e.indexOf("android")>-1?"android":e.indexOf("BlackBerry")>-1||e.indexOf("blackberry")>-1?"blackberry":"unknown"}function jumper80(e){getDeviceType();document.portFormTs.file.value=e,document.portFormTs.device.value="etc",document.portFormTs.submit()}function jumper8003(e){getDeviceType();document.portFormTs.file.value=e,document.portFormTs.device.value="phone",document.portFormTs.submit()}function jumper8002(e,t){getDeviceType();document.portForm.ref.value=e,document.portForm.name.value=t,document.portForm.device.value="phone",document.portForm.submit()}function jumper8001(e,t){getDeviceType();document.portForm.ref.value=e,document.portForm.name.value=t,document.portForm.device.value="etc",document.portForm.submit()}function ChangeTheme(e){$.ajax({url:"api/settheme?theme="+e,success:function(){window.location.hash="#settings",window.location.reload(!0)}})}function directlink(){var e=window.location.href.toLowerCase().split("#"),t="ajax/tv",n=e[1];switch(n){case"radio":case"movies":case"timer":case"settings":case"at":case"bqe":case"epgr":t="ajax/"+n}"tv"!=n&&(window.location.hash=""),load_maincontent(t)}function ShowTimers(e){e.length>0&&$(".ETV tbody").each(function(){var t=$(this).data("id").split(";");if(3==t.length){var n=t[0],r=parseInt(t[1]),i=r+60*parseInt(t[2]),a=$(this);e.forEach(function(e){if(e.sref==n){var t=parseInt(e.begin),o=parseInt(e.end);if(i>t&&o>r){var s=a.find(".addtimer").first(),c=a.find(".deltimer").first(),d=a.find(".timerpanel").first();r>=t&&o>=i?(s.hide(),c.show(),d.css("background-color","red")):d.css("background-color","yellow")}}})}})}function reversetheme(){return"pepper-grinder"==theme||"vader"==theme||"smoothness"==theme||"le-frog"==theme||"mint-choc"==theme||"humanity"==theme||"eggplant"==theme||"dot-luv"==theme||"black-tie"==theme}function getHoverCls(){return reversetheme()?"ui-state-active":"ui-state-hover"}function getActiveCls(){return reversetheme()?"ui-state-hover":"ui-state-active"}function setHover(e){var t=getHoverCls();$(e).hover(function(){$(this).addClass(t)},function(){$(this).removeClass(t)})}function setTMHover(){var e="ui-state-active";"pepper-grinder"==theme&&($(".tm_row").removeClass("ui-state-default"),$(".tm_row").addClass("ui-state-hover")),$(".tm_row").hover(function(){$(this).addClass(e)},function(){$(this).removeClass(e)})}function SetLSValue(e,t){"undefined"!=typeof Storage&&localStorage.setItem(e,t)}function GetLSValue(e,t){var n=t;if("undefined"!=typeof Storage){var r=localStorage.getItem(e);if(void 0!==r&&null!==r){if("true"===r)return!0;if("false"===r)return!1;n=r}}return n}function SetSpinner(){var e=GetLSValue("spinner","fa-spinner");loadspinner="<div id='spinner'><div class='fa "+e+" fa-spin'></div></div>"}function isInArray(e,t){return e.indexOf(t)>=0}function FillAllServices(e,t){var n="",r="",i=[];$.each(e,function(e,t){var a=t.servicereference,o=t.servicename;r+="<option value='"+encodeURIComponent(a)+"'>"+t.servicename+"</option>";var s=t.subservices,c=[];$.each(s,function(e,t){var n=t.servicereference;isInArray(i,n)||(i.push(n),"1:0:"==n.substring(0,4)&&c.push("<option value='"+n+"'>"+t.servicename+"</option>"),"1:134:1"==n.substring(0,7)&&c.push("<option value='"+encodeURIComponent(n)+"'>"+t.servicename+"</option>"))}),c.length>0&&(n+="<optgroup label='"+o+"'>"+c.join("")+"</optgroup>")}),t(n,r)}function GetAllServices(e){if("undefined"!=typeof e){var t=new Date;t=t.getFullYear()+"-"+(t.getMonth()+1)+"-"+t.getDate();var n=GetLSValue("gas-date","");if(n===t&&(n=GetLSValue("gas-data",null),null!=n)){var r=$.parseJSON(n),i=r.services;return void FillAllServices(i,e)}$.ajax({url:"/api/getallservices",success:function(n){SetLSValue("gas-data",n),SetLSValue("gas-date",t);var r=$.parseJSON(n),i=r.services;FillAllServices(i,e)}})}}$.fx.speeds._default=1e3;var theme="original",loadspinner="<div id='spinner'><div class='fa fa-spinner fa-spin'></div></div>",mutestatus=0,lastcontenturl=null,screenshotMode="all",MessageAnswerCounter=0,shiftbutton=!1,grabTimer=0,at2add=null,_location=[],_tags=[],current_ref=null,current_name=null;$(function(){SetSpinner();try{$("#dialog").dialog({autoOpen:!1,show:"fade",hide:"explode",buttons:{Ok:function(){$(this).dialog("close")}}}),$("#volimage").click(function(){0===mutestatus?(mutestatus=1,$("#volimage").attr("src","/images/volume_mute.png")):(mutestatus=0,$("#volimage").attr("src","/images/volume.png")),$.ajax("web/vol?set=mute")}),getStatusInfo(),setInterval("getStatusInfo()",15e3),$("#slider").slider({range:"min",min:0,max:100,value:40,slide:function(e,t){$("#amount").val(t.value)},stop:function(e,t){0==t.value?$("#volimage").attr("src","/images/volume_mute.png"):$("#volimage").attr("src","/images/volume.png");$.ajax("web/vol?set=set"+t.value);return!1}}),$("#amount").val($("#slider").slider("value")),$(".epgsearch button:first").button({icons:{primary:"ui-icon-search"}}),_locations=loadLocations(),_tags=loadTags()}catch(e){}}),function(e){var t={height:500,width:500,toolbar:!1,scrollbars:!1,status:!1,resizable:!1,left:0,top:0,center:!0,createNew:!0,location:!1,menubar:!1,onUnload:null};e.popupWindow=function(n,r){var i=e.extend({},t,r);i.center&&(i.top=(screen.height-i.height)/2-50,i.left=(screen.width-i.width)/2);var a=[];a.push("location="+(i.location?"yes":"no")),a.push("menubar="+(i.menubar?"yes":"no")),a.push("toolbar="+(i.toolbar?"yes":"no")),a.push("scrollbars="+(i.scrollbars?"yes":"no")),a.push("status="+(i.status?"yes":"no")),a.push("resizable="+(i.resizable?"yes":"no")),a.push("height="+i.height),a.push("width="+i.width),a.push("left="+i.left),a.push("top="+i.top);var o=(new Date).getTime(),s=i.createNew?"popup_window_"+o:"popup_window",c=window.open(n,s,a.join(","));if(i.onUnload&&"function"==typeof i.onUnload)var d=setInterval(function(){c&&!c.closed||(clearInterval(d),i.onUnload())},250);return c&&c.focus&&c.focus(),c}}(jQuery),$(function(){$(".remotegrabscreen").click(function(e){$(".remotegrabscreen").prop("checked",e.currentTarget.checked),SetLSValue("remotegrabscreen",e.currentTarget.checked)}),$("input[name=epgsearchtype]").click(function(e){$("input[name=epgsearchtype]").prop("checked",e.currentTarget.checked),SetLSValue("epgsearchtype",e.currentTarget.checked)}),"undefined"!=typeof $("input[name=epgsearchtype]")?$("input[name=epgsearchtype]").prop("checked",GetLSValue("epgsearchtype",!1)):SetLSValue("epgsearchtype",!1),$(".remotegrabscreen").prop("checked",GetLSValue("remotegrabscreen",!0))}),$(window).keydown(function(e){16==e.which&&(shiftbutton=!0)}).keyup(function(e){16==e.which&&(shiftbutton=!1)});var current_serviceref,current_begin,current_end,timeredit_initialized=!1,timeredit_begindestroy=!1,mepgdirect=0,MLHelper;!function(){var e=function(){var e,t="name";return{Init:function(){e=this},Load:function(n){t=n,$.widget("custom.iconselectmenu",$.ui.selectmenu,{_renderItem:function(e,t){var n=$("<li>"),r=$("<div>",{text:t.label}).prepend($("<span class='sortimg'>").append($("<i>",{"class":"fa "+t.element.data("class")})));return n.append(r).appendTo(e)}}),$("#moviesort").iconselectmenu({change:function(e,t){MLHelper.SortMovies(t.item.value),MLHelper.ChangeSort(t.item.value)}}).addClass("ui-menu-icons"),e.SetSortImg(),e.ReadMovies()},SetSortImg:function(){$("#moviesort option").each(function(){var e="";if($(this).val()==$("#moviesort").val()&&(e=$(this).data("class"))){var t=$("<span class='sortimg'>").append($("<i>",{"class":"fa "+e}));$("#moviesort-button .ui-selectmenu-text").prepend(t)}})},SortMovies:function(t){var n=e._movies.slice(0);"name"==t&&n.sort(function(e,t){var n=e.title.toLowerCase(),r=t.title.toLowerCase();return r>n?-1:n>r?1:0}),"named"==t&&n.sort(function(e,t){var n=t.title.toLowerCase(),r=e.title.toLowerCase();return r>n?-1:n>r?1:0}),"date"==t&&n.sort(function(e,t){return e.start-t.start}),"dated"==t&&n.sort(function(e,t){return t.start-e.start}),$("#movies").empty();for(var r=0,i=n.length;i>r;r++)$("#movies").append(n[r].html);return e.SetSortImg(),n},ChangeSort:function(e){$.ajax({url:"api/setmoviesort?nsort="+e,success:function(){}})},ReadMovies:function(){e._movies=[],$("#movies").children(".tm_row").each(function(){var t=$(this).data("start"),n=$(this).data("title");e._movies.push({id:$(this).attr("id"),title:n,start:t,html:$(this)})})},SetMovies:function(t){e._movies=t.slice()}}};"undefined"==typeof MLHelper&&(MLHelper=new e,MLHelper.Init())}();var SSHelperObj=function(){var e,t=30;return{setup:function(){e=this,e.ssr_i=parseInt(GetLSValue("ssr_i","30")),$("#screenshotbutton").buttonset(),$("#screenshotrefreshbutton").buttonset(),$("#ssr_i").val(e.ssr_i),$("#ssr_s").prop("checked",GetLSValue("ssr_s",!1)),$("#ssr_hd").prop("checked",GetLSValue("ssr_hd",!1)),$("#screenshotspinner").addClass(GetLSValue("spinner","fa-spinner")),$("#ssr_hd").change(function(){SetLSValue("ssr_hd",$("#ssr_hd").is(":checked")),grabScreenshot("auto")}),$("#ssr_i").change(function(){var n=$("#ssr_i").val();SetLSValue("ssr_i",n),t=parseInt(n),$("#ssr_s").is(":checked")&&(clearInterval(e.screenshotInterval),e.setSInterval())}),$("#ssr_s").change(function(){var t=$("#ssr_s").is(":checked");t?e.setSInterval():clearInterval(e.screenshotInterval),SetLSValue("ssr_s",t)}),screenshotMode="all",grabScreenshot(screenshotMode)},setSInterval:function(){e.screenshotInterval=setInterval("grabScreenshot('auto')",1e3*(e.ssr_i+1))}}};
