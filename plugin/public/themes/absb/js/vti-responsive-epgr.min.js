"use strict";function toUnixDate(e){var r=e.split(":"),t=new Date;return t.setHours(r[0]),t.setMinutes(r[1]),t.setSeconds(0),Math.floor(t.getTime()/1e3)}function addZero(e){return e<10&&(e="0"+e),e}function isBQ(e){return-1<e.indexOf("FROM BOUQUET")&&0!=e.indexOf("1:134:1")}function isAlter(e){return 0==e.indexOf("1:134:1")}(new function(){var h;return{setup:function(){h=this,$("#er_begin").val("22:30"),$("#er_end").val("6:30"),$("#bouquets").change(function(){$("#bouquets").val($(this).val()),h.er_bqchchanged=!0}),$("#channels").change(function(){$("#channels").val($(this).val()),h.er_bqchchanged=!0}),h.getAllServices(),$("#epgrbutton0").click(function(){h.reloadEPGR()}),$("#epgrbutton0").button({icons:{primary:"ui-icon-arrowrefresh-1-w"}}),$("#epgrbutton1").click(function(){h.saveEPGR()}),$("#epgrbutton1").button({icons:{primary:"ui-icon-disk"}}),$("#epgrbutton2").click(function(){h.DoRefresh()}),$("#statuscont").hide()},getAllServices:function(){GetAllServices(function(e,r){$("#bouquets").hide(),$("#channels").hide(),$("#channels").append(e),$("#channels").selectpicker("refresh"),$("#bouquets").append(r),$("#bouquets").selectpicker("refresh"),h.reloadEPGR(),$("#bouquets").show(),$("#channels").show()})},reloadEPGR:function(){h.showError(""),$.ajax({type:"GET",url:"/epgrefresh",dataType:"xml",success:function(e){h.readEPGR2(e)},error:function(e,r,t){h.showError(e.responseText)}})},readEPGR2:function(r){var t,n;h.er_hasAutoTimer=!1,$.ajax({type:"GET",url:"/epgrefresh/get",dataType:"xml",success:function(e){$(e).find("e2setting").each(function(){var e=$(this).find("e2settingname").text(),r=$(this).find("e2settingvalue").text();0===e.indexOf("config.plugins.epgrefresh.")?(e=e.substring(26),"True"===r?$("#er_"+e).prop("checked",!0):"False"===r?$("#er_"+e).prop("checked",!1):"begin"===e?t=r:"end"===e?n=r:"interval_seconds"==e?(h.binterval_in_seconds=!0,$("#er_interval").val(r)):"interval"==e?(h.binterval_in_seconds=!1,$("#er_interval").val(r)):$("#er_"+e).val(r)):"hasAutoTimer"===e&&"True"===r&&(h.er_hasAutoTimer=!0)}),h.UpdateCHBQ(r,t,n)},error:function(e,r,t){h.showError(e.responseText)}})},UpdateCHBQ:function(e,r,t){var n=parseInt(r),s=new Date(1e3*n),a=addZero(s.getHours()),i=addZero(s.getMinutes());$("#er_begin").val(a+":"+i),n=parseInt(t),a=addZero((s=new Date(1e3*n)).getHours()),i=addZero(s.getMinutes()),$("#er_end").val(a+":"+i);var o=[],c=[];$(e).find("e2service").each(function(){var e=$(this).find("e2servicereference").text();isBQ(e)?c.push(encodeURIComponent(e)):isAlter(e)?o.push(encodeURIComponent(e)):o.push(e)});var u=o.slice(),l=c.slice();$("#channels").val(null),$("#bouquets").val(null),$.each(l,function(e,r){$('#bouquets option[value="'+r+'"]').prop("selected",!0)}),$.each(u,function(e,r){$('#channels option[value="'+r+'"]').prop("selected",!0)}),$("#bouquets").hide(),$("#channels").hide(),$("#bouquets").selectpicker("refresh"),$("#channels").selectpicker("refresh"),$("#bouquets").show(),$("#channels").show(),h.er_bqchchanged=!1,h.binterval_in_seconds?($("#lbls").show(),$("#lblm").hide()):($("#lblm").show(),$("#lbls").hide()),h.er_hasAutoTimer?$("#er_hasAT").show():$("#er_hasAT").hide()},saveEPGR:function(){var e="/epgrefresh/set?&enabled=";e+=$("#er_enabled").is(":checked")?"true":"",e+="&enablemessage=",e+=$("#er_enablemessage").is(":checked")?"true":"",e+="&begin="+toUnixDate($("#er_begin").val()),e+="&end="+toUnixDate($("#er_end").val()),e+="&delay_standby="+$("#er_delay_standby").val(),e+="&afterevent=",e+=$("#er_afterevent").is(":checked")?"true":"",e+="&force=",e+=$("#er_force").is(":checked")?"true":"",e+="&wakeup=",e+=$("#er_wakeup").is(":checked")?"true":"",e+="&adapter="+$("#er_adapter").val(),h.er_hasAutoTimer&&(e+="&inherit_autotimer=",e+=$("#er_inherit_autotimer").is(":checked")?"true":"",e+="&parse_autotimer="+$("#er_parse_autotimer").val()),h.binterval_in_seconds?e+="&interval_seconds="+$("#er_interval").val():e+="&interval="+$("#er_interval").val(),$.ajax({type:"GET",url:e,dataType:"xml",success:function(e){var r=$(e).find("e2state").first(),t=$(e).find("e2statetext").first();h.showError(t.text(),r.text()),r&&h.SaveCHBQ()},error:function(e,r,t){h.showError(e.responseText)}})},SaveCHBQ:function(){if(!1!==h.er_bqchchanged){var t="",e=$("#bouquets").val(),r=$("#channels").val();r&&0<r.length&&$.each(r,function(e,r){isAlter(r)?t+="&sref="+r:t+="&sref="+encodeURIComponent(r)}),e&&0<e.length&&$.each(e,function(e,r){t+="&sref="+r});var n="/epgrefresh/add?multi=1";""!=t&&(n+=t,$.ajax({type:"GET",url:n,dataType:"xml",success:function(e){var r=$(e).find("e2state").first(),t=$(e).find("e2statetext").first();h.showError(t.text(),r.text())},error:function(e,r,t){h.showError(e.responseText)}}))}},DoRefresh:function(){$.ajax({type:"GET",url:"/epgrefresh/refresh",dataType:"xml",success:function(e){var r=$(e).find("e2state").first(),t=$(e).find("e2statetext").first();h.showError(t.text(),r.text())},error:function(e,r,t){h.showError(e.responseText)}})},showError:function(e,r){var t="error";!0!==(r=void 0!==r?r:"False")&&"True"!==r&&"true"!==r||(t="success"),""!==e?swal("",e,t):$("#statuscont").hide()}}}).setup();